<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Code Basics · FourierFlows.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>FourierFlows.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li class="current"><a class="toctext" href>Code Basics</a><ul class="internal"><li><a class="toctext" href="#Notation-1">Notation</a></li><li><a class="toctext" href="#Basic-steps-for-solving-a-problem:-step-through-an-example-script-1">Basic steps for solving a problem: step through an example script</a></li></ul></li><li><a class="toctext" href="../forcing/">Forcing</a></li><li><span class="toctext">Modules</span><ul><li><a class="toctext" href="../modules/kuramotosivashinsky/">Kuramoto-Sivashinsky Module</a></li><li><a class="toctext" href="../modules/traceradvdiff/">TracerAdvDiff Module</a></li></ul></li><li><span class="toctext">DocStrings</span><ul><li><a class="toctext" href="../man/types/">Private types</a></li><li><a class="toctext" href="../man/functions/">Functions</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Code Basics</a></li></ul></nav><hr/><div id="topbar"><span>Code Basics</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Code-Basics-1" href="#Code-Basics-1">Code Basics</a></h1><h2><a class="nav-anchor" id="Notation-1" href="#Notation-1">Notation</a></h2><p>The code solves differential equations of the form</p><div>\[\partial_t u = \mathcal{L}u + \mathcal{N}(u)\ ,\]</div><p>using Fourier transforms on periodic domains. The right side term <span>$\mathcal{L}u$</span> is a &#39;linear&#39; part of the equation. The term <span>$\mathcal{N}(u)$</span> is, in general, a &#39;nonlinear&#39; part. In FourierFlows, <span>$\mathcal{L}u$</span> is specified by  physical modules in Fourier space as an array with the same size as <span>$\hat u$</span>, the Fourier transform of <span>$u$</span>. The nonlinear term <span>$\mathcal{N}u$</span> is specified by a function.</p><p>Boundary conditions in all spatial dimensions are periodic. That allows us to expand all variables using a Fourier  decomposition. For example, a variable <span>$\phi(x, t)$</span> that depends in one spatial dimension is expanded as:</p><div>\[\phi(x, t) = \sum_{k} \widehat{\phi}(k, t)\,e^{\mathrm{i} k x}\ ,\]</div><p>where wavenumbers <span>$k$</span> take the values <span>$\tfrac{2\pi}{L_x}[0,\pm 1,\pm 2,\dots]$</span>. The equation is time-stepped  forward in Fourier space. That way <span>$u$</span> becomes the array with all Fourier coefficients of the solution.</p><p>The coefficients for the linear operator <span>$\mathcal{L}$</span> are stored in an array called <code>LC</code>. The term <span>$\mathcal{N}(u)$</span>  is computed for by calling the function <code>calcN!</code>.</p><h2><a class="nav-anchor" id="Basic-steps-for-solving-a-problem:-step-through-an-example-script-1" href="#Basic-steps-for-solving-a-problem:-step-through-an-example-script-1">Basic steps for solving a problem: step through an example script</a></h2><p>To illustrate the basic steps for solving a problem consider the 1D Kuramoto-Sivashinsky equation for <span>$u(x, t)$</span>:</p><div>\[\partial_t u + \partial_x^4 u + \partial_x^2 u + u\partial_x u = 0 \,\]</div><p>which in Fourier space reads:</p><div>\[\partial_t \widehat{u} = \underbrace{(- k^4 + k^2) \widehat{u}}_{\mathcal{L}\widehat{u}}
+ \underbrace{\widehat{ -u\partial_x u }}_{\mathcal{N}(\widehat{u})}\ .\]</div><p>A <code>FourierFlows.Problem</code> is composed of the following types:</p><ul><li><code>Grid</code> (<code>OneDGrid</code> in this case)</li><li><code>Params</code> (empty in this case)</li><li><code>Vars</code>, which holds <span>$u$</span>, <span>$\partial_x u$</span>, <span>$u\partial_x u$</span> and their Fourier transforms <span>$\widehat{u}$</span>, <span>$\widehat{\partial_x u}$</span>, <span>$\widehat{u\partial_xu}$</span>.</li><li><code>Equation</code>, which holds the linear coefficients <code>LC</code> and a function <code>calcN!</code> that computes <span>$\mathcal{N}(\widehat{u})$</span>.</li><li><code>TimeStepper</code> for stepping the solution forward,</li><li><code>State</code>, which holds the solution <code>sol</code> and current time <code>t</code>.</li></ul><p>The example script found in  <code>examples/kuramotosivashinsky/trefethenexample.jl</code> demonstrates the above steps  needed to construct a KuramotoSivashinsky <code>Problem</code>. For this we call  <code>prob = Problem(nx=nx, Lx=Lx, dt=dt, stepper=&quot;ETDRK4&quot;)</code>. Looking into the  <code>Problem</code>  function we can see the above steps:</p><pre><code class="language-julia">function Problem(; nx=256, Lx=2π, dt=0.01, stepper=&quot;RK4&quot;)
    g  = OneDGrid(nx, Lx)
    pr = Params()
    vs = Vars(g)
    eq = Equation(pr, g)
    ts = TimeStepper(stepper, dt, eq.LC, g)
    FourierFlows.Problem(g, vs, pr, eq, ts)
end</code></pre><p><code>OneDGrid(nx, Lx)</code> builds a one-dimensional grid with a Fourier wavenumber array <code>kr</code>:</p><pre><code class="language-julia">i1 = 0:Int(nx/2)
i2 = Int(-nx/2+1):-1
kr = Array{T}(2π/Lx*cat(1, i1))</code></pre><p>For real-valued fields we use <code>rfft</code> and thus only positive wavenumbers are involved: array <code>kr</code>.  Foe example, with <code>nx=8</code> and <code>Lx=2π</code> the wavenumber grids are: <code>k = [0, 1, 2, 3, 4, -3, -2, -1]</code> and  <code>kr = [0, 1, 2, 3, 4]</code>.</p><p>The construction of the grids only works for an <em>even</em> number of grid points. Moreover, the Fourier transforms are  most efficient when the number of grid points is the product of powers of 2 and 3. For example:  <span>$2^7=128$</span>, <span>$2^6 3^1=192$</span>, or <span>$2^8=256$</span>.</p><p><code>Vars(g)</code> initializes variables <code>u</code>, <code>ux</code>, and <code>uux</code> as real valued arrays of length <code>nx</code> and variables  <code>uh</code>, <code>uxh</code>, and <code>uuxh</code> as complex valued arrays of length <code>nkr = Int(nx/2+1)</code> (the same length as <code>kr</code>).  We use the convention that the Fourier transform of a variable is appended with an <code>h</code>, which stands for &#39;hat&#39;. For example, the transform of <code>phi</code> is <code>phih</code>.</p><p>The array <code>LC</code> is constructed by the <code>Equation</code> constructor</p><pre><code class="language-julia">function Equation(p, g)
  LC = @. g.kr^2 - g.kr^4
  FourierFlows.Equation(LC, calcN!)
end</code></pre><p>One of the fields of <code>Equation</code> is the function <code>calcN!</code>,  which computes the nonlinear term <span>$\mathcal{N}(\widehat{u})$</span>, storing the result in <code>N</code>:</p><pre><code class="language-julia">function calcN!(N, sol, t, s, v, p, g)
  @. v.uh = sol
  @. v.uxh = im*g.kr*sol
  ldiv!(v.u, g.irfftplan, v.uh) # irfft
  ldiv!(v.ux, g.irfftplan, v.uxh)
  @. v.uux = v.u*v.ux
  mul!(v.uuxh, g.rfftplan, v.uux)
  @. N = -v.uuxh
  dealias!(N, g)
  nothing
end</code></pre><p>The time-stepper is constructed and stored as <code>ts</code>. Finally, all supertypes are gathered together as a  <code>FourierFlows.Problem</code>.</p><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="../forcing/"><span class="direction">Next</span><span class="title">Forcing</span></a></footer></article></body></html>
