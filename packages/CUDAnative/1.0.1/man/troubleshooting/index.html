<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Troubleshooting Â· CUDAnative.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>CUDAnative.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="../usage/">Usage</a></li><li class="current"><a class="toctext" href>Troubleshooting</a><ul class="internal"><li><a class="toctext" href="#LLVM-IR-generated-for-...-is-not-GPU-compatible-1">LLVM IR generated for ... is not GPU compatible</a></li><li><a class="toctext" href="#Debug-info-and-line-number-information-1">Debug info and line-number information</a></li></ul></li><li><a class="toctext" href="../performance/">Performance</a></li><li><a class="toctext" href="../hacking/">Hacking</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="../../lib/compilation/">Compilation &amp; Execution</a></li><li><a class="toctext" href="../../lib/reflection/">Reflection</a></li><li><span class="toctext">Device Code</span><ul><li><a class="toctext" href="../../lib/device/intrinsics/">Intrinsics</a></li><li><a class="toctext" href="../../lib/device/array/">Arrays</a></li><li><a class="toctext" href="../../lib/device/libdevice/">libdevice</a></li></ul></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href>Troubleshooting</a></li></ul></nav><hr/><div id="topbar"><span>Troubleshooting</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Troubleshooting-1" href="#Troubleshooting-1">Troubleshooting</a></h1><p>To increase logging verbosity of the CUDAnative compiler, launch Julia with the <code>JULIA_DEBUG</code> environment variable set to <code>CUDAnative</code>.</p><h2><a class="nav-anchor" id="LLVM-IR-generated-for-...-is-not-GPU-compatible-1" href="#LLVM-IR-generated-for-...-is-not-GPU-compatible-1">LLVM IR generated for ... is not GPU compatible</a></h2><p>Not all of Julia is supported by CUDAnative. Several commonly-used features, like strings or exceptions, will not compile to GPU code, because of their interactions with the CPU-only runtime library.</p><p>When not using GPU-incompatible language features, you might still run into this compiler error when your code contains type instabilities or other dynamic behavior. These are often easily spotted by prefixing the failing function call with one of several <code>@device_code</code> macros.</p><p>For example, say we define and execute the following kernel:</p><pre><code class="language-julia">julia&gt; kernel(a) = @inbounds a[threadId().x] = 0
kernel (generic function with 1 method)

julia&gt; @cuda kernel(CuArray([1]))
ERROR: LLVM IR generated for Kernel(CuDeviceArray{Int64,1,CUDAnative.AS.Global}) is not GPU compatible</code></pre><p>When running with <code>JULIA_DEBUG=CUDAnative</code>, you will get to see the actual incompatible IR constructs. Prefixing our kernel invocation with <code>@device_code_warntype</code> reveals our issue:</p><pre><code class="language-julia">julia&gt; @device_code_warntype @cuda kernel(CuArray([1]))
Variables:
  a::CuDeviceArray{Int64,1,CUDAnative.AS.Global}
  val&lt;optimized out&gt;

Body:
  begin
      Core.SSAValue(1) = (Main.threadId)()::ANY
      Core.SSAValue(2) = (Base.getproperty)(Core.SSAValue(1), :x)::ANY
      (Base.setindex!)(a::CuDeviceArray{Int64,1,CUDAnative.AS.Global}, 0, Core.SSAValue(2))::ANY
      return 0
  end::Int64
ERROR: LLVM IR generated for Kernel(CuDeviceArray{Int64,1,CUDAnative.AS.Global}) is not GPU compatible</code></pre><p>Because of a typo, the call to <code>threadId</code> is untyped and returns <code>Any</code> (it should have been <code>threadIdx</code>). In the future, we expect to be able to catch such errors automatically.</p><p>If you want to dump all forms of generated code to disk, for further inspection, have a look at the <code>@device_code</code> macro instead.</p><h2><a class="nav-anchor" id="Debug-info-and-line-number-information-1" href="#Debug-info-and-line-number-information-1">Debug info and line-number information</a></h2><p>LLVM&#39;s NVPTX back-end does not support the undocumented PTX debug format, so we cannot generate the necessary DWARF sections. This means that debugging generated code with e.g. <code>cuda-gdb</code> will be an unpleasant experience. Nonetheless, the PTX JIT is configured to emit debug info (which corresponds with <code>nvcc -G</code>) when the Julia debug info level is 2 or higher (<code>julia -g2</code>).</p><p>We do however support emitting line number information, which is useful for other CUDA tools like <code>cuda-memcheck</code>. The functionality (which corresponds with <code>nvcc -lineinfo</code>) is enabled when the Julia debug info level is 1 (the default value). It can be disabled by passing <code>-g0</code> instead.</p><footer><hr/><a class="previous" href="../usage/"><span class="direction">Previous</span><span class="title">Usage</span></a><a class="next" href="../performance/"><span class="direction">Next</span><span class="title">Performance</span></a></footer></article></body></html>
