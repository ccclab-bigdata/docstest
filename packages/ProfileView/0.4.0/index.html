<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Readme Â· ProfileView.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ProfileView.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Readme</a><ul class="internal"><li class="toplevel"><a class="toctext" href="#Introduction-1">Introduction</a></li><li><a class="toctext" href="#Installation-1">Installation</a></li><li><a class="toctext" href="#Usage-and-visual-interpretation-1">Usage and visual interpretation</a></li><li><a class="toctext" href="#GUI-features-1">GUI features</a></li><li><a class="toctext" href="#Command-line-options-1">Command-line options</a></li></ul></li><li><a class="toctext" href="autodocs/">Docstrings</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Readme</a></li></ul></nav><hr/><div id="topbar"><span>Readme</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="ProfileView.jl-1" href="#ProfileView.jl-1">ProfileView.jl</a></h1><p><a href="https://travis-ci.org/timholy/ProfileView.jl"><img src="https://travis-ci.org/timholy/ProfileView.jl.svg" alt="Build Status"/></a></p><p>Note this README is for users of Julia 0.7 and higher; users of earlier versions should see <a href="https://github.com/timholy/ProfileView.jl/tree/julia0.6">this page</a>.</p><h1><a class="nav-anchor" id="Introduction-1" href="#Introduction-1">Introduction</a></h1><p>This package contains tools for visualizing profiling data collected with [Julia&#39;s][Julia] built-in sampling <a href="http://docs.julialang.org/en/latest/stdlib/profile/">profiler</a>. It can be helpful for getting a big-picture overview of the major bottlenecks in your code, and optionally highlights lines that trigger garbage collection as potential candidates for optimization.</p><p>This type of plot is known as a <a href="https://github.com/brendangregg/FlameGraph">flame graph</a>.</p><h2><a class="nav-anchor" id="Installation-1" href="#Installation-1">Installation</a></h2><p>Within Julia, use the package manager:</p><pre><code class="language-julia">Pkg.add(&quot;ProfileView&quot;)</code></pre><h2><a class="nav-anchor" id="Usage-and-visual-interpretation-1" href="#Usage-and-visual-interpretation-1">Usage and visual interpretation</a></h2><p>To demonstrate ProfileView, first we have to collect some profiling data. Here&#39;s a simple test function for demonstration:</p><pre><code class="language-julia">function profile_test(n)
    for i = 1:n
        A = randn(100,100,20)
        m = maximum(A)
        Am = mapslices(sum, A; dims=2)
        B = A[:,:,5]
        Bsort = mapslices(sort, B; dims=1)
        b = rand(100)
        C = B.*b
    end
end

profile_test(1)  # run once to trigger compilation
using Profile
Profile.clear()  # in case we have any previous profiling data
@profile profile_test(10)</code></pre><p>Now that we have profiling data, visualizing it is a simple matter:</p><pre><code class="language-none">julia&gt; using ProfileView

julia&gt; ProfileView.view()</code></pre><p>If you&#39;re following along, you should see something like this:</p><p><img src="readme_images/pv1.jpg" alt="ProfileView"/></p><p>(Note that collected profiles can vary from run-to-run, so don&#39;t be alarmed if you get something different.) This plot is a visual representation of the <em>call graph</em> of the code that you just profiled. The &quot;root&quot; of the tree is at the bottom; if you move your mouse the long horizontal bars near the bottom, you should fine one for <code>eval_user_input</code> in REPL.jl. As is explained <a href="http://docs.julialang.org/en/latest/stdlib/profile/">elsewhere</a>, these are what run your code in the REPL. If you move your mouse upwards, you&#39;ll eventually get to the function(s) you ran with <code>@profile</code>.</p><p>While the vertical axis therefore represents nesting depth, the horizontal axis represents the amount of time (more precisely, the number of backtraces) spent at each line.  One sees on the 4th line from the bottom, there are several differently-colored bars, each corresponding to a different line of <code>profile_test</code>. The fact that they are all positioned on top of the lower peach-colored bar means that all of these lines are called by the same &quot;parent&quot; function. Within a block of code, they are sorted in order of increasing line number, to make it easier for you to compare to the source code.</p><p>From this visual representation, we can very quickly learn several things about this function:</p><ul><li><p>The most deeply-nested call corresponds to the <code>mapslices(sort, B; dims=1)</code> call. (If you hover over the top-most bars you will see they correspond to lines in <code>sort.jl</code>.) In contrast, the call to <code>maximum</code> (the lowest blue bar) resolves to just two (non-inlined) calls.</p></li><li><p><code>mapslices(sum, A; dims=2)</code> is considerably more expensive than <code>mapslices(sort, B; dims=1)</code>. (This is because it has to process more data.)</p></li></ul><p>It is also worth noting that red is a special color: it is reserved for function calls that have to be resolved at run-time (by virtue of their execution of the C functions <code>jl_invoke</code> or <code>jl_apply_generic</code>). Because run-time dispatch (aka, run-time method lookup or a virtual call) often has a significant impact on performance, we highlight the problematic call in red. It&#39;s worth noting that some red is unavoidable; for example, the REPL can&#39;t predict in advance the return types from what users type at the prompt, and so <code>eval_user_input</code> is red. Red bars are problematic only when they account for a sizable fraction of the top &quot;row,&quot; as only in such cases are they likely to be the source of a significant performance bottleneck. We can see that <code>mapslices</code> relies on run-time dispatch; from the absence of pastel-colored bars above much of the red, we might guess that this makes a substantial contribution to its total run time.</p><h2><a class="nav-anchor" id="GUI-features-1" href="#GUI-features-1">GUI features</a></h2><h3><a class="nav-anchor" id="Gtk-Interface-1" href="#Gtk-Interface-1">Gtk Interface</a></h3><ul><li><p>Ctrl-q and Ctrl-w close the window. You can also use <code>ProfileView.closeall()</code> to close all windows opened by ProfileView.</p></li><li><p>Left-clicking on a bar will cause information about this line to be printed in the REPL. This can be a convenient way to &quot;mark&quot; lines for later investigation.</p></li><li><p>Right-clicking on a bar calls the <code>edit()</code> function to open the line in an editor</p></li><li><p>CTRL-click lets you zoom in on a specific region of the image, and click-drag lets you pan the view. You can pan by scrolling the mouse (scroll=vertical, SHIFT-scroll=horizontal), and change zoom level with CTRL-scroll. You can also use your keyboard (arrow keys, plus SHIFT and CTRL modifiers). Double-click to restore the full view.</p></li><li><p>To use the Gtk interface in Juno or IJulia, set <code>PROFILEVIEW_USEGTK = true</code> in the <code>Main</code> module before <code>using ProfileView</code>.</p></li><li><p>The toolbar at the top contains two icons to load and save profile data, respectively.  Clicking the save icon will prompt you for a filename.  Launching <code>ProfileView.view(nothing)</code> opens a blank window; you can populate it with saved data by clicking on the &quot;open&quot; icon.</p></li></ul><h3><a class="nav-anchor" id="IJulia-(SVG)-Interface-1" href="#IJulia-(SVG)-Interface-1">IJulia (SVG) Interface</a></h3><ul><li><p>Double-clicking on a bar will zoom in the graph around the bar.</p></li><li><p>Double-clicking on the background will zoom out to show the entire graph.</p></li><li><p>Click-drag anywhere on the graph will allow for panning.</p></li></ul><h2><a class="nav-anchor" id="Command-line-options-1" href="#Command-line-options-1">Command-line options</a></h2><p>The <code>view</code> command has the following syntax:</p><pre><code class="language-none">function view(data = Profile.fetch(); lidict = nothing, C = false, colorgc = true, fontsize = 12, combine = true, pruned = [])</code></pre><p>Here is the meaning of the different arguments:</p><ul><li><p>The first is the vector containing backtraces. You can use <code>data1 = copy(Profile.fetch()); Profile.clear()</code> to store and examine results from multiple profile runs simultaneously.</p></li><li><p><code>lidict</code> is a dictionary containing &quot;line information.&quot; See the section on saving profile data below.</p></li><li><p><code>C</code> is a flag controlling whether lines corresponding to C and Fortran code are displayed. (Internally, ProfileView uses the information from C backtraces to learn about garbage-collection and to disambiguate the call graph).</p></li><li><p><code>colorgc</code>, when <code>true</code>, causes lines triggering garbage-collection to be displayed in red.</p></li><li><p><code>fontsize</code> controls the size of the font displayed as a tooltip.</p></li><li><p><code>combine</code> is explained <a href="http://docs.julialang.org/en/latest/stdlib/profile/">elsewhere</a>.</p></li><li><p><code>pruned</code> is a list of functions (see example) whose call tree will not be displayed. This is useful to control the output of very deep (or recursive) functions. Example: <code>pruned = [(&quot;sort!&quot;, &quot;sort.jl&quot;), (&quot;some_function_name&quot;, &quot;some_filename.jl&quot;)]</code></p></li></ul><h3><a class="nav-anchor" id="Saving-profile-data-manually-1" href="#Saving-profile-data-manually-1">Saving profile data manually</a></h3><p>If you&#39;re using the Gtk backend, the easiest approach is to click on the &quot;Save as&quot; icon.</p><p>From the REPL, you can save profile data for later viewing and analysis using the JLD file format. The main trick is that the backtrace data, on its own, is only valid within a particular julia session. To become portable, you have to save &quot;line information&quot; that looks up the particular line number in the source code corresponding to a particular machine instruction. Here&#39;s an example:</p><pre><code class="language-julia">li, lidict = Profile.retrieve()
using JLD
@save &quot;/tmp/foo.jlprof&quot; li lidict</code></pre><p>Now open a new julia session, and try the following:</p><pre><code class="language-none">using HDF5, JLD, ProfileView
@load &quot;/tmp/profdata.jld&quot;
ProfileView.view(li, lidict=lidict)</code></pre><h3><a class="nav-anchor" id="Saving-ProfileView-visualizations-1" href="#Saving-ProfileView-visualizations-1">Saving ProfileView visualizations</a></h3><p>You can share your profiling results with others either as an SVG file or as an IJulia notebook. Simply use</p><pre><code class="language-none">ProfileView.svgwrite(&quot;profile_results.svg&quot;)</code></pre><p>or</p><pre><code class="language-none">ProfileView.svgwrite(&quot;profile_results.svg&quot;, bt, lidict)</code></pre><p>if you&#39;ve <code>retrieve</code>d stored data.</p><p>Alternatively, run ProfileView inside an IJulia notebook and then save the notebook.</p><p>[Julia]: http://julialang.org &quot;Julia&quot;</p><footer><hr/><a class="next" href="autodocs/"><span class="direction">Next</span><span class="title">Docstrings</span></a></footer></article></body></html>
