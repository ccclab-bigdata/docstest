<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Zoom and pan Â· GtkReactive</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>GtkReactive</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Introduction</a></li><li><a class="toctext" href="../controls/">A first example: GUI controls</a></li><li><a class="toctext" href="../drawing/">A simple drawing program</a></li><li class="current"><a class="toctext" href>Zoom and pan</a><ul class="internal"></ul></li><li><a class="toctext" href="../reference/">Reference</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Zoom and pan</a></li></ul></nav><hr/><div id="topbar"><span>Zoom and pan</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Zoom-and-pan-1" href="#Zoom-and-pan-1">Zoom and pan</a></h1><p>In addition to low-level canvas support, GtkReactive also provides high-level functions to make it easier implement rubber-banding, pan, and zoom functionality.</p><p>To illustrate these tools, let&#39;s first open a window with a drawing canvas:</p><pre><code class="language-julia-repl">julia&gt; using Gtk.ShortNames, GtkReactive, TestImages

julia&gt; win = Window(&quot;Image&quot;);

julia&gt; c = canvas(UserUnit);

julia&gt; push!(win, c);</code></pre><p>As explained in <a href="../drawing/#A-simple-drawing-program-1">A simple drawing program</a>, the <code>UserUnit</code> specifies that mouse pointer positions will be reported in the units we specify, through a <code>set_coordinates</code> call below.</p><p>Now let&#39;s load an image to draw into the canvas:</p><pre><code class="language-julia-repl">julia&gt; image = testimage(&quot;lighthouse&quot;);</code></pre><p>For what follows, it may be worth reminding readers that julia arrays are indexed as <code>image[row, column]</code>, whereas for graphics we usually think in terms of <code>(x, y)</code>. Since <code>x</code> corresponds to <code>column</code> and <code>y</code> corresponds to <code>row</code>, some operations will require that we swap the first and second indices.</p><p>Zoom and pan interactions all work through a <a href="../reference/#GtkReactive.ZoomRegion"><code>ZoomRegion</code></a> signal; let&#39;s create one for this image:</p><pre><code class="language-julia-repl">julia&gt; zr = Signal(ZoomRegion(image))
8: &quot;input-6&quot; = ZoomRegion{RoundingIntegers.RInt64}(XY(1..768, 1..512), XY(1..768, 1..512)) ZoomRegion{RoundingIntegers.RInt64}</code></pre><p>The key thing to note here is that it has been created for the intervals <code>1..768</code> (corresponding to the width of the image) and <code>1..512</code> (the height of the image). Let&#39;s now create a <code>view</code> of the image as a Signal:</p><pre><code class="language-julia-repl">julia&gt; imgsig = map(zr) do r
           cv = r.currentview   # extract the currently-selected region
           # Create a SubArray covering just the selected region (see `?view`)
           view(image, UnitRange{Int}(cv.y), UnitRange{Int}(cv.x))
       end;</code></pre><p><code>imgsig</code> is a Signal that holds a &quot;sub-image,&quot; one that updates any time <code>zr</code> is modified. We then define a <code>draw</code> method for the canvas that paints this selection to the canvas:</p><pre><code class="language-julia-repl">julia&gt; redraw = draw(c, imgsig, zr) do cnvs, img, r
           # Copy the pixel data to the canvas. Because `img` is the value of `imgsig`,
           # this will only copy the region that was selected by the `view` call above.
           copy!(cnvs, img)

           # Here we set the coordinates of the canvas to correspond
           # to the selected region of the image. This ensures that
           # every point on the canvas has coordinates that correspond
           # to the same position in the image.
           set_coordinates(cnvs, r)
       end
7: &quot;map(map(input-5), input-5)&quot; = nothing Nothing</code></pre><p>We won&#39;t need to do anything further with <code>redraw</code>, but as a reminder: by assigning it to a variable we ensure it won&#39;t be garbage-collected (if that happened, the canvas would stop updating when <code>imgsig</code> and/or <code>zr</code> update).</p><p>Now, let&#39;s see our image:</p><pre><code class="language-julia-repl">julia&gt; Gtk.showall(win);</code></pre><p><img src="../assets/image1.png" alt="image1"/></p><p>We could <code>push!</code> values to <code>zr</code> and see the image update:</p><pre><code class="language-julia-repl">julia&gt; push!(zr, (100:300, axes(image, 2)))</code></pre><p><img src="../assets/image2.png" alt="image2"/></p><p>More useful is to couple <code>zr</code> to mouse actions. Let&#39;s turn on both zooming (with <a href="../reference/#GtkReactive.init_zoom_rubberband"><code>init_zoom_rubberband</code></a>) and panning (with <a href="../reference/#GtkReactive.init_pan_drag"><code>init_pan_drag</code></a>):</p><pre><code class="language-julia-repl">julia&gt; rb = init_zoom_rubberband(c, zr)
Dict{String,Signal} with 5 entries:
  &quot;drag&quot;    =&gt; 15: &quot;map(filterwhen(input-8, input-4))&quot; = nothing Nothing
  &quot;init&quot;    =&gt; 13: &quot;map(filterwhen(input-7, input-2))&quot; = nothing Nothing
  &quot;active&quot;  =&gt; 11: &quot;input-8&quot; = false Bool
  &quot;finish&quot;  =&gt; 17: &quot;map(filterwhen(input-8, input-3))&quot; = nothing Nothing
  &quot;enabled&quot; =&gt; 10: &quot;input-7&quot; = true Bool

julia&gt; pandrag = init_pan_drag(c, zr)
Dict{String,Signal} with 5 entries:
  &quot;drag&quot;    =&gt; 23: &quot;map(filterwhen(input-10, input-4))&quot; = nothing Nothing
  &quot;init&quot;    =&gt; 21: &quot;map(filterwhen(input-9, input-2))&quot; = nothing Nothing
  &quot;active&quot;  =&gt; 19: &quot;input-10&quot; = false Bool
  &quot;finish&quot;  =&gt; 25: &quot;map(filterwhen(input-10, input-3))&quot; = nothing Nothing
  &quot;enabled&quot; =&gt; 18: &quot;input-9&quot; = true Bool</code></pre><p>Now hold down your <code>Ctrl</code> key on your keyboard, click on the image, and drag to select a region of interest. You should see the image zoom in on that region. Then try clicking your mouse (without holding <code>Ctrl</code>) and drag; the image will move around, following your mouse. Double-click on the image while holding down <code>Ctrl</code> to zoom out to full view. The use of these modifier keys can be customized through keyword arguments to <code>init_zoom_rubberband</code> and <code>init_pan_drag</code>.</p><p>The returned dictionaries have a number of signals necessary for internal operations. Perhaps the only important user-level element is <code>enabled</code>; if you <code>push!(rb[&quot;enabled&quot;], false)</code> then you can (temporarily) turn off rubber-band initiation.</p><p>If you have a wheel mouse, you can activate additional interactions with <a href="../reference/#GtkReactive.init_zoom_scroll"><code>init_zoom_scroll</code></a> and <a href="../reference/#GtkReactive.init_pan_scroll"><code>init_pan_scroll</code></a>.</p><footer><hr/><a class="previous" href="../drawing/"><span class="direction">Previous</span><span class="title">A simple drawing program</span></a><a class="next" href="../reference/"><span class="direction">Next</span><span class="title">Reference</span></a></footer></article></body></html>
