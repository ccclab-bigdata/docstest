<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Integration Guide: Port to v0.5.0 Â· Mimi.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Mimi.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../installation/">Installation Guide</a></li><li><a class="toctext" href="../userguide/">User Guide</a></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="../tutorials/tutorial_main/">Tutorials Intro</a></li><li><a class="toctext" href="../tutorials/tutorial_1/">1 Run an Existing Model</a></li><li><a class="toctext" href="../tutorials/tutorial_2/">2 Modify an Existing Model</a></li><li><a class="toctext" href="../tutorials/tutorial_3/">3 Create a Model</a></li><li><a class="toctext" href="../tutorials/tutorial_4/">4 MCS Functionality</a></li></ul></li><li><a class="toctext" href="../faq/">FAQ</a></li><li><a class="toctext" href="../reference/">Reference</a></li><li class="current"><a class="toctext" href>Integration Guide: Port to v0.5.0</a><ul class="internal"><li><a class="toctext" href="#Overview-1">Overview</a></li><li><a class="toctext" href="#Defining-Components-1">Defining Components</a></li><li><a class="toctext" href="#Constructing-a-Model-1">Constructing a Model</a></li><li><a class="toctext" href="#Running-a-Model-1">Running a Model</a></li><li><a class="toctext" href="#Accessing-Results-1">Accessing Results</a></li><li><a class="toctext" href="#Plotting-and-the-Explorer-UI-1">Plotting and the Explorer UI</a></li><li><a class="toctext" href="#Advanced-Topics-1">Advanced Topics</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Integration Guide: Port to v0.5.0</a></li></ul></nav><hr/><div id="topbar"><span>Integration Guide: Port to v0.5.0</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Integration-Guide:-Porting-Mimi-Models-from-v0.4.0-to-v0.5.0-1" href="#Integration-Guide:-Porting-Mimi-Models-from-v0.4.0-to-v0.5.0-1">Integration Guide:  Porting Mimi Models from v0.4.0 to v0.5.0</a></h1><h2><a class="nav-anchor" id="Overview-1" href="#Overview-1">Overview</a></h2><p>The release of Mimi v0.5.0 is a breaking release, necessitating the adaptation of existing models&#39; syntax and structure in order for those models to run on this new version.  This guide provides an overview of the steps required to get most models using the v0.4.0 API working with v0.5.0.  It is <strong>not</strong> a comprehensive review of all changes and new functionalities, but a guide to the minimum steps required to port old models between versions.  For complete information on the new version and its functionalities, see the full documentation.</p><p>This guide is organized into six main sections, each descripting an independent set of changes that can be undertaken in any order desired.  For clarity, these sections echo the organization of the <code>userguide</code>.</p><ol><li>Defining components</li><li>Constructing a model</li><li>Running the model</li><li>Accessing results</li><li>Plotting</li><li>Advanced topics</li></ol><p><strong>A Note on Function Naming</strong>: There has been a general overhaul on function names, especially those in the explicity user-facing API, to be consistent with Julia conventions and the conventions of this Package.  These can be briefly summarized as follows:</p><ul><li>use <code>_</code> for readability</li><li>append all functions with side-effects, i.e., non-pure functions that return a value but leave all else unchanged with a <code>!</code></li><li>the commonly used terms <code>component</code>, <code>variable</code>, and <code>parameter</code> are shortened to <code>comp</code>, <code>var</code>, and <code>param</code></li><li>functions that act upon a <code>component</code>, <code>variable</code>, or <code>parameter</code> are often written in the form <code>[action]_[comp/var/param]</code></li></ul><h2><a class="nav-anchor" id="Defining-Components-1" href="#Defining-Components-1">Defining Components</a></h2><p>The <code>run_timestep</code> function is now contained by the <code>@defcomp</code> macro, and takes the parameters <code>p, v, d, t</code>, referring to Parameters, Variables, and Dimensions of the component you defined.  The fourth argument is an <code>AbstractTimestep</code>, i.e., either a <code>FixedTimestep</code> or a <code>VariableTimestep</code>.  Similarly, the optional <code>init</code> function is also contained by <code>@defcomp</code>, and takes the parameters <code>p, v, d</code>.  Thus, as described in the user guide, defining a single component is now done as follows:</p><p>In this version, the fourth argument (<code>t</code> below) can no longer always be used simply as an <code>Int</code>. Indexing with <code>t</code> is still permitted, but special care must be taken when comparing <code>t</code> with conditionals or using it in arithmatic expressions.  The full API as described later in this document in <strong>Advanced Topics:  Timesteps and available functions</strong>.  Since differential equations are commonly used as the basis for these models&#39; equations, the most commonly needed change will be changing <code>if t == 1</code> to <code>if is_first(t)</code></p><pre><code class="language-julia">@defcomp component1 begin

    # First define the state this component will hold
    savingsrate = Parameter()

    # Second, define the (optional) init function for the component
    function init(p, v, d)
    end

    # Third, define the run_timestep function for the component
    function run_timestep(p, v, d, t)
    end

end</code></pre><h2><a class="nav-anchor" id="Constructing-a-Model-1" href="#Constructing-a-Model-1">Constructing a Model</a></h2><p>In an effort to standardize the function naming protocol within Mimi, and to streamline it with the Julia convention, several function names have been changed.  The table below lists a <strong>subset</strong> of these changes, focused on the exported API functions most commonly used in model construction.  </p><table><tr><th>Old Syntax</th><th>New Syntax</th></tr><tr><td><code>addcomponent!</code></td><td><code>add_comp!</code></td></tr><tr><td><code>connectparameter</code></td><td><code>connect_param!</code></td></tr><tr><td><code>setleftoverparameters</code></td><td><code>set_leftover_params!</code></td></tr><tr><td><code>setparameter</code></td><td><code>set_param!</code></td></tr><tr><td><code>adddimension</code></td><td><code>add_dimension!</code></td></tr><tr><td><code>setindex</code></td><td><code>set_dimension!</code></td></tr></table><p>Changes to various optional keyword arguments:</p><ul><li><code>add_comp!</code>:  Previously the optional keyword arguments <code>start</code> and <code>stop</code> could be used to specify times for components that do not run for the full length of the model. These arguments are now <code>first</code> and <code>last</code> respectively.</li></ul><pre><code class="language-julia">add_comp!(mymodel, ComponentC; first=2010, last=2100)</code></pre><h2><a class="nav-anchor" id="Running-a-Model-1" href="#Running-a-Model-1">Running a Model</a></h2><h2><a class="nav-anchor" id="Accessing-Results-1" href="#Accessing-Results-1">Accessing Results</a></h2><h2><a class="nav-anchor" id="Plotting-and-the-Explorer-UI-1" href="#Plotting-and-the-Explorer-UI-1">Plotting and the Explorer UI</a></h2><p>This release of Mimi does not include the plotting functionality previously offered by Mimi.  While the previous files are still included, the functions are not exported as efforts are made to simplify and improve the plotting associated with Mimi.  </p><p>The new version does, however, include a new UI tool that can be used to visualize model results.  This <code>explore</code> function is described in the User Guide under <strong>Advanced Topics</strong>.</p><h2><a class="nav-anchor" id="Advanced-Topics-1" href="#Advanced-Topics-1">Advanced Topics</a></h2><h3><a class="nav-anchor" id="Timesteps-and-available-functions-1" href="#Timesteps-and-available-functions-1">Timesteps and available functions</a></h3><p>As previously mentioned, some relevant function names have changed.  These changes were made to eliminate ambiguity.  For example, the new naming clarifies that <code>is_last</code> returns whether the timestep is on the last valid period to be run, not whether it has run through that period already.  This check can still be achieved with <code>is_finished</code>, which retains its name and function.  Below is a subset of such changes related to timesteps and available functions.</p><table><tr><th>Old Syntax</th><th>New Syntax</th></tr><tr><td><code>isstart</code></td><td><code>is_first</code></td></tr><tr><td><code>isstop</code></td><td><code>is_last</code></td></tr></table><p>As mentioned in earlier in this document, the fourth argument in <code>run_timestep</code> is an <code>AbstractTimestep</code> i.e. a <code>FixedTimestep</code> or a <code>VariableTimestep</code> and is a type defined within Mimi in &quot;src/time.jl&quot;.  In this version, the fourth argument (<code>t</code> below) can no longer always be used simply as an <code>Int</code>. Defining the <code>AbstractTimestep</code> object as <code>t</code>, indexing with <code>t</code> is still permitted, but special care must be taken when comparing <code>t</code> with conditionals or using it in arithmatic expressions.  Since differential equations are commonly used as the basis for these models&#39; equations, the most commonly needed change will be changing <code>if t == 1</code> to <code>if is_first(t)</code>.  There are also new useful functions including <code>is_time(t, y)</code> and <code>is_timestep(t, s)</code>.</p><p>The full API:</p><ul><li>you may index into a variable or parameter with <code>[t]</code> or <code>[t +/- x]</code> as usual</li><li>to access the time value of <code>t</code> (currently a year) as a <code>Number</code>, use <code>gettime(t)</code></li><li>useful functions for commonly used conditionals are <code>is_first(t)</code>,<code>is_last(t)</code>, <code>is_time(t, y)</code>, and <code>is_timestep(t, s)</code>as listed above</li><li>to access the index value of <code>t</code> as a <code>Number</code> representing the position in the time array, use <code>t.t</code>.  Users are encouraged to avoid this access, and instead use the options listed above or a separate counter variable. each time the function gets called.  </li></ul><h3><a class="nav-anchor" id="Parameter-connections-between-different-length-components-1" href="#Parameter-connections-between-different-length-components-1">Parameter connections between different length components</a></h3><h3><a class="nav-anchor" id="More-on-parameter-indices-1" href="#More-on-parameter-indices-1">More on parameter indices</a></h3><h3><a class="nav-anchor" id="Updating-an-external-parameter-1" href="#Updating-an-external-parameter-1">Updating an external parameter</a></h3><p>To update an external parameter, use the functions <code>update_param!</code> and <code>udpate_params!</code> (previously known as <code>update_external_parameter</code> and <code>update_external_parameters</code>, respectively.)  Their calling signatures are:</p><ul><li><p><code>update_params!(md::ModelDef, parameters::Dict; update_timesteps = false)</code></p></li><li><p><code>update_param!(md::ModelDef, name::Symbol, value; update_timesteps = false)</code></p></li></ul><p>For external parameters with a <code>:time</code> dimension, passing <code>update_timesteps=true</code> indicates that the time <em>keys</em> (i.e., year labels) should also be updated in addition to updating the parameter values.</p><h3><a class="nav-anchor" id="Setting-parameters-with-a-dictionary-1" href="#Setting-parameters-with-a-dictionary-1">Setting parameters with a dictionary</a></h3><p>The function <code>set_leftover_params!</code> replaces the function <code>setleftoverparameters</code>.</p><h3><a class="nav-anchor" id="Using-NamedArrays-for-setting-parameters-1" href="#Using-NamedArrays-for-setting-parameters-1">Using NamedArrays for setting parameters</a></h3><h3><a class="nav-anchor" id="The-internal-&#39;build&#39;-function-and-model-instances-1" href="#The-internal-&#39;build&#39;-function-and-model-instances-1">The internal &#39;build&#39; function and model instances</a></h3><footer><hr/><a class="previous" href="../reference/"><span class="direction">Previous</span><span class="title">Reference</span></a></footer></article></body></html>
