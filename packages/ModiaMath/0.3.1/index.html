<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home Â· ModiaMath</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ModiaMath</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href="index.html">Home</a><ul class="internal"><li><a class="toctext" href="#Installation-1">Installation</a></li><li><a class="toctext" href="#Release-Notes-1">Release Notes</a></li></ul></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="man/Overview.html">Overview</a></li><li><a class="toctext" href="man/Plans.html">Plans for version 1.0</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="lib/SimulationEngine.html">SimulationEngine</a></li><li><a class="toctext" href="lib/Result.html">Result</a></li><li><a class="toctext" href="lib/DAE.html">DAE</a></li><li><a class="toctext" href="lib/NonlinearEquations.html">NonlinearEquations</a></li><li><a class="toctext" href="lib/Variables.html">Variables</a></li><li><a class="toctext" href="lib/Logging.html">Logging</a></li><li><a class="toctext" href="lib/Frames.html">Frames</a></li><li><a class="toctext" href="lib/Utilities.html">Utilities</a></li><li><a class="toctext" href="lib/ModiaMath.html">ModiaMath Constants and Types</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href="index.html">Home</a></li></ul></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="ModiaMath.jl-Documentation-1" href="#ModiaMath.jl-Documentation-1">ModiaMath.jl Documentation</a></h1><p><a href="https://github.com/ModiaSim/ModiaMath.jl">ModiaMath</a> provides a simulation engine and other mathematical utilities for packages <a href="https://github.com/ModiaSim/Modia.jl">Modia</a> and <a href="https://github.com/ModiaSim/Modia3D.jl">Modia3D</a> that are used to model physical systems such as electrical circuits, robots, or vehicles. The recommended way is to use ModiaMath via Modia or Modia3D. However, ModiaMath is self-contained and can be also used without Modia/Modia3D.</p><p>The central part of ModiaMath is a simulation engine to solve <em>implicit index one Differential Algebraic Equations (DAEs)</em> with and without <em>time and state events</em>. The theory is partially described in <a href="http://www.ep.liu.se/ecp/132/064/ecp17132565.pdf">(Otter/Elmqvist, 2017)</a>. In particular it is shown, that a large class of DAEs can be transformed <em>automatically</em> to this form (including multibody systems with kinematic loops). As integrator currently IDA of the <a href="https://computation.llnl.gov/projects/sundials">Sundials integrator suite</a> is used (via the Julia <a href="https://github.com/JuliaDiffEq/Sundials.jl">Sundials interface package</a>). It is planned to adapt ModiaMath to Julia package <a href="https://github.com/JuliaDiffEq/DifferentialEquations.jl">DifferentialEquations</a> and use IDA and other appropriate integrators via this package in the future.</p><p>Additionally, ModiaMath provides functions to perform plotting in a convenient way, to generate and use rotation matrices and quaternions for kinematic transformations in 3D, and to provide an infrastructure for DAE variables as needed by Modia3D.</p><h2><a class="nav-anchor" id="Installation-1" href="#Installation-1">Installation</a></h2><p>ModiMath is registered in METADATA.jl and can be installed with Pkg.add.</p><pre><code class="language-julia"># Julia 0.6, 0.7, 1.0:
julia&gt; Pkg.add(&quot;ModiaMath&quot;)

# alternatively in Julia 0.7 and 1.0:
julia&gt; ]add ModiaMath</code></pre><p>ModiaMath uses PyPlot for plotting. If <code>PyPlot</code> is not available in your current Julia environment an information message is printed and all <code>ModiaMath.plot(..)</code> calls are ignored. In order that plot windows are displayed, you need to add <code>PyPlot</code> to your current environment via <code>Pkg.add(&quot;PyPlot&quot;)</code>. Often this automatic installation fails and it is recommended to follow instead the instructions <a href="https://github.com/ModiaSim/ModiaMath.jl/wiki/Installing-PyPlot-in-a-robust-way">Installing PyPlot in a robust way</a>.</p><h2><a class="nav-anchor" id="Release-Notes-1" href="#Release-Notes-1">Release Notes</a></h2><h3><a class="nav-anchor" id="Version-0.3.0-1" href="#Version-0.3.0-1">Version 0.3.0</a></h3><ul><li>ModiaMath initialization and re-initialization improved:<ul><li>Initialization and re-initialization considerably changed (now only one nonlinear equation is solved and no longer two nonlinear equations).</li><li>By this change, several issues in the initialization were fixed.</li><li>x_nominal also supported for ModiaMath.Variables.</li></ul></li></ul><h3><a class="nav-anchor" id="Version-0.2.6-1" href="#Version-0.2.6-1">Version 0.2.6</a></h3><ul><li><p>ModiaMath initialization and simulation improved:</p><ul><li>Issue with defaultInterval fixed: Previously: defaultInterval = (defaultStopTime - defaultStartTime)/500.0. However, if stopTime was set to 10e5, then the defaultInterval was much too small. This was changed so that defaultInterval is either explicitly given, or it is computed from the actual values of StopTime and StartTime.</li><li>x_nominal introduced in constructor of simulation state (DAE.SimulationState) and of Modia interface (ModiaToModiaMath.ModiaSimulationModel): If x_nominal is explicitly provided in these constructor calls, it is used. Otherwise <code>x_nominal[i]</code> is set to <code>max(abs(x_start[i]), 1e-7)</code>.</li><li>x_nominal is newly used in KINSOL to scale the unknowns and is used to compute the absolute tolerance for Sundials IDA.</li><li>A bug was corrected in the initialization function, where rScale was reported to KINSOL, but was also used for scaling of the residue (although this is performed in KINSOL).</li><li>If log=true, name-, start-, fixed-, nominal-values of the x-vector are printed before initialization starts.</li></ul></li><li><p>New function <em>ModiaMath.solveOneNonlinearEquation</em>: Determines the solution of one non-linear algebraic equation <code>y=f(u)</code> in one unknown <code>u</code> in a reliable and efficient way (using Brents algorithm).</p></li></ul><h3><a class="nav-anchor" id="Version-0.2.5-1" href="#Version-0.2.5-1">Version 0.2.5</a></h3><ul><li><p>ModiaMath initialization improved:</p><ul><li>KINSOL tolerance FTOL takes IDA tolerance into acount.</li><li>More information about the model is provided in case KINSOL fails.</li></ul></li><li><p>Interface to Modia improved: New keyword option hev (step size used for implicit Euler during initialization and at events) added to &quot;simulate&quot;.</p></li><li><p>ModiaMath result handling improved:</p><ul><li>The result may contain single values (such as parameter J=0.1). When using plot(..) on such a result variable, a constant line is plotted between the first and the last point of the x-axis.</li><li>New function <code>ModiaMath.resultTable(result)</code> to transform the variable information in the result data structure in a DataFrames table (containing variable name + type + size ) that can then be printed.</li><li>New functions <code>ModiaMath.closeFigure(figure)</code> and <code>ModiaMath.closeAllFigures()</code> to close a specific figure or close all figures.</li><li>Changing some default options of PyPlot. In particular, (a) the labels on the x- and y-axis use exponential notation (e.g. 1e5), if the numbers are larger as 1e4 or smaller as 1e-3 (PyPlot default is 1e7 and 1e-7), (b) smaller fonts and linewidth are used. Default options are changed via PyCall. If PyCall is not in the Julia environment, PyCall is added.</li><li>If a vector or matrix of subplots is defined, then the x-axis labels are only displayed for the last subplot row.</li><li>Result data is always converted to Float64 before passing it to PyPlot. Therefore, Julia numbers can be plotted, even if the types of the numbers are not supported by PyPlot (for example rational numbers can be plotted).</li></ul></li></ul><h3><a class="nav-anchor" id="Version-0.2.4-1" href="#Version-0.2.4-1">Version 0.2.4</a></h3><ul><li><p><strong>Non-backwards compatible change of ModiaMath.plot(..)</strong>: The function was changed to only support result dictionaries of the type <code>Dict{AbstractString,Any}</code> to simplify implementation and maintenance and to use the identical dictionary type as in Modia.</p></li><li><p>ModiaMath.plot(..) improved:</p><ul><li>For the dictionary type used by Modia, all elements of a variable vector are plotted by giving the variable name, or one specific element of the variable vector is plotted by giving the name and the vector index.</li><li>A new keyword argument <code>maxLegend=10</code> introduced: If the number of entries in a legend exceeds this number, no legend is included in the plot. Note, the curves can still be identified by clicking in the tool bar of the plot window on button <code>Edit axis, curve ..</code>.</li><li>If the plot function is used in the wrong way (e.g. signals shall be plotted that are not in the result dictionary, or selecting a variable vector as x-axis), warning messages are printed and the call is ignored.</li></ul></li><li><p>Dependent packages updated to their newest versions. Especially, warnings from Unitful do no longer occur, due to the update to version 0.12.0.</p></li><li><p>Issue with PyPlot warnings fixed: When ModiaMath was used in another package (e.g. in Modia or Modia3D), strange warning messages appeared when importing it. This issue was fixed with the solution sketched in <a href="https://discourse.julialang.org/t/how-to-remove-pyplot-jl-from-the-distribution-of-a-package-that-uses-it/15130/10?u=martinotter">discourse</a>.</p></li></ul><h3><a class="nav-anchor" id="Version-0.2.3-1" href="#Version-0.2.3-1">Version 0.2.3</a></h3><ul><li>Wrong UUID of ModiaMath corrected (did not correspond to the UUID in Julias METADATA).</li></ul><h3><a class="nav-anchor" id="Version-0.2.2-1" href="#Version-0.2.2-1">Version 0.2.2</a></h3><ul><li><p>PyPlot was removed from the REQUIRE and Project.toml files and code was added, so that PyPlot is automatically imported in ModiaMath if it is available in the current environment of the user. The benefit is that ModiaMath can be used, even if PyPlot is not installed. This is especially useful for ContinuousIntegration, because automatic installation of PyPlot often fails. Inspect the wiki page <a href="https://github.com/ModiaSim/ModiaMath.jl/wiki/Installing-PyPlot-in-a-robust-way">Installing PyPlot in a robust way</a> to install PyPlot in a robust way.</p></li><li><p>All extra packages used in examples and tests are now referenced via ModiaMath (for example <code>using ModiaMath.StaticArrays</code> instead of <code>using StaticArrays</code>). The benefit is that all examples and tests can be directly executed with <code>include</code> (for example: <code>import ModiaMath; include($(ModiaMath.path)/examples/Simulate_Pendulum.jl)</code>) provided <code>ModiaMath</code> is in the current environment. Previously, it was assumed that these extra packages are present in the users environment and an error occured, if this was not the case.</p></li><li><p>New arguments <code>prefix</code> and <code>reuse</code> added to ModiaMath.plot(..) to add new plots (e.g. from a new simulation run) to an existing figure, without clearing the figure beforehand.</p></li></ul><h3><a class="nav-anchor" id="Version-0.2.1-1" href="#Version-0.2.1-1">Version 0.2.1</a></h3><ul><li><p>Adapted to Julia 0.7 and 1.0 (including using new package manager via Project.toml, Manifest.toml files and adapting the README.md and documentation files).</p></li><li><p>Buttons for Travis CL, code coverage and docs added to README.md file. (this includes adaptations to .travis.yml file). Note, Appveyor CL is not yet activated (although appveyor.yml file is present).</p></li><li><p>Interface call to KINSOL slightly improved to avoid a gc-crash.</p></li><li><p>In case KINSOL fails, more run-time information is added to the error message.</p></li><li><p>Indentation was changed consistently to 4 spaces.</p></li></ul><h3><a class="nav-anchor" id="Version-0.2.0-1" href="#Version-0.2.0-1">Version 0.2.0</a></h3><ul><li>First public release (for Julia 0.6)</li></ul><footer><hr/><a class="next" href="man/Overview.html"><span class="direction">Next</span><span class="title">Overview</span></a></footer></article></body></html>
