<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Overview · ModiaMath</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ModiaMath</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">Home</a></li><li><span class="toctext">Manual</span><ul><li class="current"><a class="toctext" href="Overview.html">Overview</a><ul class="internal"><li><a class="toctext" href="#Mathematical-Description-1">Mathematical Description</a></li><li><a class="toctext" href="#Getting-Started-1">Getting Started</a></li><li><a class="toctext" href="#Package-structure-1">Package structure</a></li></ul></li><li><a class="toctext" href="Plans.html">Plans for version 1.0</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="../lib/SimulationEngine.html">SimulationEngine</a></li><li><a class="toctext" href="../lib/Result.html">Result</a></li><li><a class="toctext" href="../lib/DAE.html">DAE</a></li><li><a class="toctext" href="../lib/NonlinearEquations.html">NonlinearEquations</a></li><li><a class="toctext" href="../lib/Variables.html">Variables</a></li><li><a class="toctext" href="../lib/Logging.html">Logging</a></li><li><a class="toctext" href="../lib/Frames.html">Frames</a></li><li><a class="toctext" href="../lib/Utilities.html">Utilities</a></li><li><a class="toctext" href="../lib/ModiaMath.html">ModiaMath Constants and Types</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href="Overview.html">Overview</a></li></ul></nav><hr/><div id="topbar"><span>Overview</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Overview-1" href="#Overview-1">Overview</a></h1><h2><a class="nav-anchor" id="Mathematical-Description-1" href="#Mathematical-Description-1">Mathematical Description</a></h2><p>ModiaMath provides a simulation engine and other mathematical utilities  to solve initial value problems of the following <strong>implicit index 1 DAE with events</strong> (containing an ODE or a semi-explicit index 1 DAE as special cases; x(t), z(t) are real vectors):</p><div>\[\begin{align}
 z &amp;= f_z(x, t) \\
 0 &amp;= f_d(\dot{x}, x, t, z_i &gt; 0) \\
 0 &amp;= f_c(x, t, z_i &gt; 0) \\
 J &amp;= \left[ \frac{\partial f_d}{\partial \dot{x}};  
             \frac{\partial f_c}{\partial x} \right] \; \text{is regular}
\end{align}\]</div><p>where</p><div>\[\lim_{\epsilon \rightarrow 0} x(t_0 - \epsilon) = x_0^{-}\]</div><p>is given. Equations <span>$z=z(t)$</span> are zero-crossing functions. Whenever a <span>$z_i(t)$</span> crosses zero  the integration is halted, functions <span>$f_d, f_c$</span> might be changed and  afterwards integration is restarted. If the Jacobian <span>$J$</span> is <strong>regular</strong>, the DAE has an index 1 (= by differentiating <span>$f_c$</span> once, the system can be transformed to an ODE).</p><p>Given a DAE model, ModiaMath assumes that <span>$J$</span> is <strong>regular</strong> for all time instants. If this condition is violated, initialization and simulation will usually fail and an error message of the form <em>&quot;Solver does not converge&quot;</em> might appear. Note, ModiaMath does not check this condition and can therefore not provide better diagnostics in such cases.</p><p>Initial conditions <span>$x_0^{-}$</span> must be provided before simulation can start. They need  <strong>not</strong> to fulfil the constraint equations, so <span>$f_c (x_0^{-},t_0 )≠0$</span> is allowed. If this is the case, initialization will simulate for an infinitesimal small time instant  so that <span>$x_0^{-}$</span> changes discontinuously to <span>$x_0^{+}$</span> with <span>$f_c (x_0^{+},t_0 )=0$</span>.  Note, <span>$\dot{x}$</span> is a Dirac impulse if <span>$x$</span> changes discontinuously at initialization.</p><p>As shown in xxx, every DAE can be transformed to the form above, at least in principal. In yyy algorithms are proposed to automatically transform a large class of DAEs to this form <em>without solving algebraic equations and retaining the sparsity of the equations</em>.  This may require to analytically differentiating equations. The algorithms of this paper are implemented in the Julia package <code>Modia</code> which in turn uses <code>ModiaMath</code>. In <code>Modia3D</code> the transformation to this form is built into the package itself.</p><p>Note, the above DAE could be further transformed to an ODE (<span>$\dot{x} = f(x,t)$</span>), but then the evaluation of function <span>$f(x,t)$</span> might require to solve local linear and/or nonlinear equation systems. Furthermore, there are systems  (for example ModiaMath/examples/Simulate_FreeBodyRotation.jl) where the ODE states <span>$x$</span> need to be dynamically changed during simulation.</p><p>It is highly recommended to use <code>Modia</code> or <code>Modia3D</code> for simulating DAEs because this is much simpler and less error prone as when utilizing ModiaMath directly. However, ModiaMath can be also used without Modia or Modia3D. In this case, basically one Julia function with the following interface has to be provided (and in this function specific utility functions can be called)</p><pre><code class="language-julia">getModelResidues(m::AbstractSimulationModel, t::Float64, x::Vector{Float64},  
                 derx::Vector{Float64}, r::Vector{Float64}</code></pre><p>where <code>r</code> is the vector of residues (<span>$r = \left[ f_d; f_c \right]$</span>). Given the  simulation model <code>m</code> (= a mutable struct), the actual time instant <code>t</code>, the DAE variables <code>x(t)</code> and their derivatives <code>derx(t)</code>, the function has to compute the residue vector <code>r(t)</code>. In directory ModiaMath/examples/withoutMacros_withoutVariables several examples are present that are based on this interface.</p><p>In order to simplify the definition of direct ModiaMath models (to evaluate and test ModiaMath  functionality), the macro <a href="../lib/Variables.html#ModiaMath.Variables.@component-Tuple{Any,Any}"><code>@component</code></a> has been introduced. The examples in directory ModiaMath/examples/xxx.jl use this model definition. In directory ModiaMath/examples/withoutMacros/xxx.jl the same examples are present, however, the macro has been manually expanded (to show and test the result of the macro). The <a href="../lib/Variables.html#ModiaMath.Variables.@component-Tuple{Any,Any}"><code>@component</code></a> does not yet support events. If events are present in a model, the model has to be defined as shown in the examples of directory ModiaMath/examples/withoutMacros_withoutVariables.</p><h2><a class="nav-anchor" id="Getting-Started-1" href="#Getting-Started-1">Getting Started</a></h2><p>You can just past the following code into the Julia REPL.</p><h3><a class="nav-anchor" id="To-define-a-model-1" href="#To-define-a-model-1">To define a model</a></h3><p>(note, it is simpler and less error prone to define a model with Modia or Modia3D):</p><pre><code class="language-julia">  using ModiaMath
  using StaticArrays

  @component Pendulum(;L=1.0, m=1.0, d=0.1, g=9.81) begin
     phi = RealScalar(start=pi/2, unit=&quot;rad&quot;    , fixed=true,               numericType=ModiaMath.XD_EXP)
     w   = RealScalar(start=0.0 , unit=&quot;rad/s&quot;  , fixed=true, integral=phi, numericType=ModiaMath.XD_EXP)
     a   = RealScalar(            unit=&quot;rad/s^2&quot;,             integral=w  , numericType=ModiaMath.DER_XD_EXP) 
     r   = RealSVector{2}(        unit=&quot;m&quot;      ,                           numericType=ModiaMath.WC)
  end;

  function ModiaMath.computeVariables!(p::Pendulum, sim::ModiaMath.SimulationState)  
     L = p.L; m = p.m; d = p.d; g = p.g; phi = p.phi.value; w = p.w.value
   
     p.a.value = (-m*g*L*sin(phi) - d*w) / (m*L^2)

     if ModiaMath.isStoreResult(sim)
        p.r.value = @SVector [L*sin(phi), -L*cos(phi)]
     end
  end;

  simulationModel = ModiaMath.SimulationModel(Pendulum(L=0.8, m=0.5, d=0.2), stopTime=5.0);
</code></pre><h3><a class="nav-anchor" id="To-simulate-a-model-and-plot-results:-1" href="#To-simulate-a-model-and-plot-results:-1">To simulate a model and plot results:</a></h3><pre><code class="language-julia">  result = ModiaMath.simulate!(simulationModel; log=true);
  plot(result, [(:phi, :w) :a])</code></pre><p>This results in:</p><img src="../../resources/images/pendulumPlot.svg"><h3><a class="nav-anchor" id="To-run-examples-and-tests:-1" href="#To-run-examples-and-tests:-1">To run examples and tests:</a></h3><pre><code class="language-julia"># run examples
import ModiaMath
include(&quot;$(ModiaMath.path)/examples/Simulate_Pendulum.jl&quot;)         # ODE as index-0 DAE
include(&quot;$(ModiaMath.path)/examples/Simulate_FreeBodyRotation.jl&quot;) # index-1 DAE
include(&quot;$(ModiaMath.path)/examples/withoutMacros_withoutVariables/Simulate_PendulumDAE.jl&quot;) # index-3 DAE
include(&quot;$(ModiaMath.path)/examples/withoutMacros_withoutVariables/Simulate_SimpleStateEvents.jl&quot;)
include(&quot;$(ModiaMath.path)/examples/withoutMacros_withoutVariables/Simulate_BouncingBall.jl&quot;)

# run all tests
include(&quot;$(ModiaMath.path)/test/runtests.jl&quot;)</code></pre><h2><a class="nav-anchor" id="Package-structure-1" href="#Package-structure-1">Package structure</a></h2><p>The ModiaMath package is structured in the a set of sub-modules. The most important are:</p><ul><li><p><a href="../lib/SimulationEngine.html#ModiaMath.SimulationEngine"><code>ModiaMath.SimulationEngine</code></a><br/>The engine to simulate implicit index 1 DAEs with events.</p></li><li><p><a href="../lib/DAE.html#ModiaMath.DAE"><code>ModiaMath.DAE</code></a><br/>Interface between the SimulationEngine and the index 1 DAE model (e.g. initialization and event iteration is performed here).</p></li><li><p><a href="../lib/Result.html#ModiaMath.Result"><code>ModiaMath.Result</code></a><br/>The <code>plot</code> function of this module allows to plot the result data of the simulation engine by giving the signal names. With tuples and/or vectors/matrices of signal names, the window layout of the figures is defined. The legends/labels of the plots are automatically constructed by the signal names and their units.</p></li><li><p><a href="../lib/Variables.html#ModiaMath.Variables"><code>ModiaMath.Variables</code></a><br/>Provides Variable types to define properties of the variables on a higher level and copy automatically the interface vectors from the integrator into the variables and vice versa.</p></li><li><p><a href="../lib/Frames.html#ModiaMath.Frames"><code>ModiaMath.Frames</code></a><br/>Functions that generate and operate on frames, that is coordinate systems in 3D. The orientation of a frame is described either with a 3x3 rotation matrix or with a  quaternion vector. This module is currently mainly used from Modia3D, but the functionality is useful for all 3D programs.</p></li></ul><footer><hr/><a class="previous" href="../index.html"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="Plans.html"><span class="direction">Next</span><span class="title">Plans for version 1.0</span></a></footer></article></body></html>
