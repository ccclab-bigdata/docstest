<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Readme Â· UnsafeArrays.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>UnsafeArrays.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Readme</a><ul class="internal"></ul></li><li><a class="toctext" href="autodocs/">Docstrings</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Readme</a></li></ul></nav><hr/><div id="topbar"><span>Readme</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="UnsafeArrays.jl-1" href="#UnsafeArrays.jl-1">UnsafeArrays.jl</a></h1><p><a href="https://travis-ci.org/oschulz/UnsafeArrays.jl"><img src="https://travis-ci.org/oschulz/UnsafeArrays.jl.svg?branch=master" alt="Build Status"/></a> <a href="https://ci.appveyor.com/project/oschulz/unsafearrays-jl/branch/master"><img src="https://ci.appveyor.com/api/projects/status/github/oschulz/UnsafeArrays.jl?branch=master&amp;svg=true" alt="Build status"/></a> <a href="https://codecov.io/gh/oschulz/UnsafeArrays.jl"><img src="https://codecov.io/gh/oschulz/UnsafeArrays.jl/branch/master/graph/badge.svg" alt="codecov"/></a></p><p>UnsafeArrays provides stack-allocated pointer-based array views for Julia. This package is mainly intended as a workaround for <a href="https://github.com/JuliaLang/julia/issues/14955">Julia issue #14955 (non-allocating array views)</a>.</p><p>While the Julia compiler is able to elide heap-allocation of views in some cases, it cannot always do so. In some other cases, the relative cost of allocation and garbage collection of a even a large number of views is small. Especially in multi-threaded applications though, this cost can quickly become prohibitive and views must either be avoided (resulting in more lengthy and less readable code), or some form stack-allocated views must be used for decent scalability. UnsafeArrays aims to provide such a solution.</p><p>Example:</p><pre><code class="language-none">using Compat, Base.Threads, Compat.LinearAlgebra
using Compat: axes

function colnorms!(dest::AbstractVector, A::AbstractMatrix)
    @threads for i in axes(A, 2)
        dest[i] = norm(view(A, :, i))
    end
    dest
end

A = rand(50, 100000);
dest = similar(A, size(A, 2));

colnorms!(dest, A)</code></pre><p>The above will run fine on a single thread, but scales badly on multiple threads. Use the <code>@uviews</code> macro provided by UnsafeArrays to replace A with an <code>UnsafeArray</code> within the scope of the macro. An <code>UnsafeArray</code> is stack-allocated, and so are all views of it, e.g. within <code>colnorms!</code>:</p><pre><code class="language-none">using UnsafeArrays

@uviews A begin
    colnorms!(dest, A)
end</code></pre><p><code>@uviews</code> protects the original array <code>A</code> from GC, so the above is safe as long as the original array is not reallocated (via <code>resize!</code>, etc.) while the scope of <code>@uviews</code> is active.</p><p>UnsafeArrays only supports bits types. If the element type of an array is not compatible, @uviews will simply use the original array.</p><p>UnsafeArrays also provides:</p><ul><li><p>A non macro-variant <code>uviews()</code></p></li><li><p>A function <code>uview()</code> to directly get an unsafe view (with optional sub-indexing) of an array.</p></li><li><p>The type <code>UnsafeArray</code> itself, instances can be constructed from a data pointer and array size. The data type must be a bits type.</p></li></ul><p>When using <code>uview()</code> and <code>UnsafeArray</code> directly, the user is responsible for preserving the memory accessed from garbage collection.</p><footer><hr/><a class="next" href="autodocs/"><span class="direction">Next</span><span class="title">Docstrings</span></a></footer></article></body></html>
