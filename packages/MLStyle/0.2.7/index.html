<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · MLStyle.jl</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-89508993-1', 'auto');
ga('send', 'pageview');
</script><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>MLStyle.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Home</a><ul class="internal"><li><a class="toctext" href="#What&#39;s-MLStyle.jl?-1">What&#39;s MLStyle.jl?</a></li><li><a class="toctext" href="#Motivation-1">Motivation</a></li><li><a class="toctext" href="#Why-to-use-MLStyle.jl-1">Why to use MLStyle.jl</a></li><li><a class="toctext" href="#Installation,-Documentations-and-Tutorials-1">Installation, Documentations and Tutorials</a></li><li><a class="toctext" href="#Preview-1">Preview</a></li><li><a class="toctext" href="#Benchmark-1">Benchmark</a></li><li><a class="toctext" href="#Contributing-to-MLStyle-1">Contributing to MLStyle</a></li></ul></li><li><span class="toctext">Syntax</span><ul><li><a class="toctext" href="syntax/adt/">Algebraic Data Types</a></li><li><a class="toctext" href="syntax/pattern/">Pattern</a></li><li><a class="toctext" href="syntax/pattern-function/">Pattern function</a></li><li><a class="toctext" href="syntax/when/">When Destructuring</a></li></ul></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="tutorials/capture/">Static Capturing</a></li><li><a class="toctext" href="tutorials/query-lang/">Write You A Query Language</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Home</a></li></ul></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="MLStyle.jl-1" href="#MLStyle.jl-1">MLStyle.jl</a></h1><p><a href="https://travis-ci.org/thautwarm/MLStyle.jl"><img src="https://travis-ci.org/thautwarm/MLStyle.jl.svg?branch=master" alt="Build Status"/></a> <a href="https://codecov.io/gh/thautwarm/MLStyle.jl"><img src="https://codecov.io/gh/thautwarm/MLStyle.jl/branch/master/graph/badge.svg" alt="codecov"/></a> <a href="https://github.com/thautwarm/MLStyle.jl/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License"/></a> <a href="https://thautwarm.github.io/MLStyle.jl/latest/"><img src="https://img.shields.io/badge/docs-latest-purple.svg" alt="Docs"/></a>  <a href="https://gitter.im/MLStyle-jl/community?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/MLStyle-jl/community.svg" alt="Join the chat at https://gitter.im/MLStyle-jl/community"/></a></p><h2><a class="nav-anchor" id="What&#39;s-MLStyle.jl?-1" href="#What&#39;s-MLStyle.jl?-1">What&#39;s MLStyle.jl?</a></h2><p>MLStyle.jl is a Julia package that provides multiple productivity tools from ML(<a href="https://en.wikipedia.org/wiki/ML_(programming_language)">Meta Language</a>) like <a href="https://en.wikipedia.org/wiki/Pattern_matching">pattern matching</a> that&#39;re statically generated and extensible, ADTs/GADTs(<a href="https://en.wikipedia.org/wiki/Algebraic_data_type">Algebraic Data Type</a>, <a href="https://en.wikipedia.org/wiki/Generalized_algebraic_data_type">Generalized Algebraic Data Type</a>) and <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/active-patterns">Active Patterns</a>.</p><p>If you still have problems with the scoping of MLStyle.jl, treat it as <strong>FP.jl</strong>.</p><h2><a class="nav-anchor" id="Motivation-1" href="#Motivation-1">Motivation</a></h2><p>The people who&#39;re used to so-called functional programming could become retarded when there&#39;re no pattern matching and ADTs, and of course I&#39;m one of them.</p><p>However, I don&#39;t want to take a trade-off here to use some available alternatives that miss features or are not well-optimized. Just like <a href="https://julialang.org/blog/2012/02/why-we-created-julia">why those greedy people created Julia</a>, I&#39;m also so greedy that <strong>I want to integrate all those useful features into one language and, make all of them convenient, efficient and extensible</strong>.</p><p>On the other side, during recent years I was addicted to extend Python with metaprogramming and even internal mechanisms. Although I made something interesting like <a href="https://github.com/Xython/pattern-matching">pattern-matching</a>, <a href="https://github.com/thautwarm/Redy/blob/master/Redy/Opt/builtin_features/_goto.py">goto</a>, <a href="https://github.com/thautwarm/Redy/tree/master/Redy/ADT">ADTs</a>, <a href="https://github.com/thautwarm/Redy/blob/master/Redy/Opt/builtin_features/_constexpr.py">constexpr</a>, <a href="https://github.com/thautwarm/Redy/blob/master/Redy/Opt/builtin_features/_macro.py">macros</a>, etc., most of these implementations are so disgustingly evil. Furtunately, in Julia, all of them could be achieved straightforwardly without any black magic, at last, some of these ideas come into the existence of MLStyle.jl.</p><p>Finally, we finish such a library that provides <strong>extensible pattern matching</strong> in such an efficient language.</p><h2><a class="nav-anchor" id="Why-to-use-MLStyle.jl-1" href="#Why-to-use-MLStyle.jl-1">Why to use MLStyle.jl</a></h2><ul><li>Straightforward</li></ul><pre><code class="language-none">I think there is no need to talk about why we
should use pattern mathing instead of manually 
writing something like conditional branches and
nested visitors for datatypes.</code></pre><ul><li>Performance Gain</li></ul><pre><code class="language-none">When dealing with complex conditional logics and
visiting nested datatypes, the codes compiled via
`MLStyle.jl` could always match the handwritten.

You can check [Benchmark](#benchmark) for details.</code></pre><ul><li>Extensibility and Hygienic Scoping</li></ul><pre><code class="language-none">You can define your own patterns via the interfaces
`def_pattern`, `def_app_pattern` and `def_gapp_pattern`.

Almost all built-in patterns are defined at [Pervasives.jl](https://github.com/thautwarm/MLStyle.jl/blob/master/src/Pervasives.jl).

Once you define a pattern, you&#39;re to be asked to give some
qualifiers to your own patterns to prevent visiting them
from unexpected modules.</code></pre><ul><li>* Modern Ways about AST Manipulations</li></ul><pre><code class="language-none">MLStyle.jl is not a superset of MacroToos.jl, but
it provides something useful for AST manipulations.

Furthermore, in terms of extracting sub-structures from
a given AST, using expr patterns and AST patterns could
make a orders of magnitude speed up.</code></pre><h2><a class="nav-anchor" id="Installation,-Documentations-and-Tutorials-1" href="#Installation,-Documentations-and-Tutorials-1">Installation, Documentations and Tutorials</a></h2><p>Rich features are provided by MLStyle.jl and you can check <a href="https://thautwarm.github.io/MLStyle.jl/latest/">documents</a> to get started.</p><p>For installation, open package manager mode in Julia shell and <code>add MLStyle</code>.</p><p>For more examples or tutorials, check <a href="https://github.com/thautwarm/MLStyle-Playground">this project</a> which will be frequently updated to present some interesting uses of MLStyle.jl.</p><h2><a class="nav-anchor" id="Preview-1" href="#Preview-1">Preview</a></h2><p>In this README I&#39;m glad to share some non-trivial code snippets.</p><h3><a class="nav-anchor" id="Homoiconic-pattern-matching-for-Julia-ASTs-1" href="#Homoiconic-pattern-matching-for-Julia-ASTs-1">Homoiconic pattern matching for Julia ASTs</a></h3><pre><code class="language-julia">rmlines = @λ begin
    e :: Expr           -&gt; Expr(e.head, filter(x -&gt; x !== nothing, map(rmlines, e.args))...)
      :: LineNumberNode -&gt; nothing
    a                   -&gt; a
end
expr = quote
    struct S{T}
        a :: Int
        b :: T
    end
end |&gt; rmlines

@match expr begin
    quote
        struct $name{$tvar}
            $f1 :: $t1
            $f2 :: $t2
        end
    end =&gt;
    quote
        struct $name{$tvar}
            $f1 :: $t1
            $f2 :: $t2
        end
    end |&gt; rmlines == expr
end</code></pre><h3><a class="nav-anchor" id="Generalized-Algebraic-Data-Types-1" href="#Generalized-Algebraic-Data-Types-1">Generalized Algebraic Data Types</a></h3><pre><code class="language-julia">@use GADT

@data public Exp{T} begin
    Sym       :: Symbol =&gt; Exp{A} where {A}
    Val{A}    :: A =&gt; Exp{A}
    App{A, B} :: (Exp{Fun{A, B}}, Exp{A_}) =&gt; Exp{B} where {A_ &lt;: A}
    Lam{A, B} :: (Symbol, Exp{B}) =&gt; Exp{Fun{A, B}}
    If{A}     :: (Exp{Bool}, Exp{A}, Exp{A}) =&gt; Exp{A}
end
</code></pre><p>A simple intepreter implementation using GADTs could be found at <code>test/untyped_lam.jl</code>.</p><h3><a class="nav-anchor" id="Active-Patterns-1" href="#Active-Patterns-1">Active Patterns</a></h3><p>Currently, in MLStyle it&#39;s not a <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/active-patterns">full featured</a> one, but even a subset with parametric active pattern could be super useful.</p><pre><code class="language-julia">@active Re{r :: Regex}(x) begin
    match(r, x)
end

@match &quot;123&quot; begin
    Re{r&quot;\d+&quot;}(x) =&gt; x
    _ =&gt; @error &quot;&quot;
end # RegexMatch(&quot;123&quot;)</code></pre><h2><a class="nav-anchor" id="Benchmark-1" href="#Benchmark-1">Benchmark</a></h2><h3><a class="nav-anchor" id="Prerequisite-1" href="#Prerequisite-1">Prerequisite</a></h3><p>Recently the rudimentary benchmarks have been finished, which turns out that MLStyle.jl could be extremely fast when matching cases are complicated, while in terms of some very simple cases(straightforward destruct shallow tuples, arrays and datatypes without recursive invocations), Match.jl could be faster.</p><p>All benchmark scripts are provided at directory <a href="https://github.com/thautwarm/MLStyle.jl/blob/master/matrix-benchmark">Matrix-Benchmark</a>.</p><p>To run these cross-implementation benchmarks, some extra dependencies should be installed:</p><ul><li><code>(v1.1) pkg&gt; add https://github.com/thautwarm/Benchmarkplotting.jl#master</code> for making cross-implementation benchmark methods and plotting.</li></ul><ul><li><code>(v1.1) pkg&gt; add Gadfly MacroTools Match BenchmarkTools StatsBase Statistics ArgParse DataFrames</code>.</li></ul><ul><li><code>(v1.1) pkg&gt; add MLStyle#base</code> for a specific version of MLStyle.jl is required.</li></ul><p>After installing dependencies, you can directly benchmark them with <code>julia matrix_benchmark.jl hw-tuple hw-array match macrotools match-datatype</code> at the root directory.</p><p>The benchmarks presented here are made by Julia <strong>v1.1</strong> on <strong>Fedora 28</strong>. For reports made on <strong>Win10</strong>, check <a href="https://github.com/thautwarm/MLStyle.jl/tree/master/stats/windows">stats/windows/</a> directory.</p><h3><a class="nav-anchor" id="Visualization-1" href="#Visualization-1">Visualization</a></h3><h4><a class="nav-anchor" id="Time-Overhead-1" href="#Time-Overhead-1">Time Overhead</a></h4><p>In x-axis, after the name of test-case is the least time-consuming one&#39;s index, the unit is <code>ns</code>).</p><p>The y-label is the ratio of the implementation&#39;s time cost to that of the least time-consuming.</p><h4><a class="nav-anchor" id="Allocation-1" href="#Allocation-1">Allocation</a></h4><p>In x-axis, after the name of test-case is the least allocted one&#39;s index, the unit is <code>_ -&gt; (_ + 1) bytes</code>).</p><p>The y-label is the ratio of  the implementation&#39;s allocation cost to that of the least allocted.</p><h4><a class="nav-anchor" id="Gallery-1" href="#Gallery-1">Gallery</a></h4><p>Check https://github.com/thautwarm/MLStyle.jl/tree/master/stats.</p><h2><a class="nav-anchor" id="Contributing-to-MLStyle-1" href="#Contributing-to-MLStyle-1">Contributing to MLStyle</a></h2><p>Thanks to all individuals referred in <a href="https://github.com/thautwarm/MLStyle.jl/blob/master/acknowledgements.txt">Acknowledgements</a>!</p><p>Feel free to ask questions about usage, development or extensions about MLStyle at <a href="https://gitter.im/MLStyle-jl/community?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge">Gitter Room</a>.</p><footer><hr/><a class="next" href="syntax/adt/"><span class="direction">Next</span><span class="title">Algebraic Data Types</span></a></footer></article></body></html>
