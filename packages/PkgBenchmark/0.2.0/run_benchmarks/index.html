<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a benchmark suite · PkgBenchmark.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>PkgBenchmark.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../define_benchmarks/">Defining a benchmark suite</a></li><li class="current"><a class="toctext" href>Running a benchmark suite</a><ul class="internal"><li><a class="toctext" href="#More-advanced-customization-1">More advanced customization</a></li></ul></li><li><a class="toctext" href="../comparing_commits/">Comparing commits</a></li><li><a class="toctext" href="../export_markdown/">Export to markdown</a></li><li><a class="toctext" href="../ref/">Reference</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Running a benchmark suite</a></li></ul></nav><hr/><div id="topbar"><span>Running a benchmark suite</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Running-a-benchmark-suite-1" href="#Running-a-benchmark-suite-1">Running a benchmark suite</a></h1><p>Use <code>benchmarkpkg</code> to run benchmarks defined in a suite as defined in the previous section.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="PkgBenchmark.benchmarkpkg" href="#PkgBenchmark.benchmarkpkg"><code>PkgBenchmark.benchmarkpkg</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">benchmarkpkg(pkg, [target]::Union{String, BenchmarkConfig}; kwargs...)</code></pre><p>Run a benchmark on the package <code>pkg</code> using the <a href="../ref/#PkgBenchmark.BenchmarkConfig"><code>BenchmarkConfig</code></a> or git identifier <code>target</code>. Examples of git identifiers are commit shas, branch names, or e.g. &quot;HEAD~1&quot;. Return a <a href="#PkgBenchmark.BenchmarkResults"><code>BenchmarkResults</code></a>.</p><p>The argument <code>pkg</code> can be a name of a package or a path to a directory to a package.</p><p><strong>Keyword arguments</strong>:</p><ul><li><code>script</code> - The script with the benchmarks, if not given, defaults to <code>benchmark/benchmarks.jl</code> in the package folder.</li><li><code>resultfile</code> - If set, saves the output to <code>resultfile</code></li><li><code>retune</code> - Force a re-tune, saving the new tuning to the tune file.</li></ul><p>The result can be used by functions such as <a href="../comparing_commits/#BenchmarkTools.judge"><code>judge</code></a>. If you choose to, you can save the results manually using <a href="../ref/#PkgBenchmark.writeresults-Tuple{String,BenchmarkResults}"><code>writeresults</code></a> where <code>results</code> is the return value of this function. It can be read back with <a href="../ref/#PkgBenchmark.readresults-Tuple{String}"><code>readresults</code></a>.</p><p><strong>Example invocations:</strong></p><pre><code class="language-julia">using PkgBenchmark

import MyPkg
benchmarkpkg(pathof(MyPkg)) # run the benchmarks at the current state of the repository
benchmarkpkg(pathof(MyPkg), &quot;my-feature&quot;) # run the benchmarks for a particular branch/commit/tag
benchmarkpkg(pathof(MyPkg), &quot;my-feature&quot;; script=&quot;/home/me/mycustombenchmark.jl&quot;)
benchmarkpkg(pathof(MyPkg), BenchmarkConfig(id = &quot;my-feature&quot;,
                                            env = Dict(&quot;JULIA_NUM_THREADS&quot; =&gt; 4),
                                            juliacmd = `julia -O3`))</code></pre></div></div></section><p>The results of a benchmark is returned as a <code>BenchmarkResult</code></p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="PkgBenchmark.BenchmarkResults" href="#PkgBenchmark.BenchmarkResults"><code>PkgBenchmark.BenchmarkResults</code></a> — <span class="docstring-category">Type</span>.</div><div><div><p>Stores the results from running the benchmarks on a package.</p><p>The following (unexported) methods are defined on a <code>BenchmarkResults</code> (written below as <code>results</code>):</p><ul><li><code>name(results)::String</code> - The commit of the package benchmarked</li><li><code>commit(results)::String</code> - The commit of the package benchmarked. If the package repository was dirty, the string <code>&quot;dirty&quot;</code> is returned.</li><li><code>juliacommit(results)::String</code> - The commit of the Julia executable that ran the benchmarks</li><li><code>benchmarkgroup(results)::BenchmarkGroup</code> - a <a href="https://github.com/JuliaCI/BenchmarkTools.jl/blob/master/doc/manual.md#the-benchmarkgroup-type"><code>BenchmarkGroup</code></a>  contaning the results of the benchmark.</li><li><code>date(results)::DateTime</code> - Tthe time when the benchmarks were executed</li><li><code>benchmarkconfig(results)::BenchmarkConfig</code> - The <a href="../ref/#PkgBenchmark.BenchmarkConfig"><code>BenchmarkConfig</code></a> used for the benchmarks.</li></ul><p><code>BenchmarkResults</code> can be exported to markdown using the function <a href="../export_markdown/#PkgBenchmark.export_markdown"><code>export_markdown</code></a>.</p></div></div></section><h2><a class="nav-anchor" id="More-advanced-customization-1" href="#More-advanced-customization-1">More advanced customization</a></h2><p>Instead of passing a commit, branch etc. as a <code>String</code> to <code>benchmarkpkg</code>, a <a href="../ref/#PkgBenchmark.BenchmarkConfig"><code>BenchmarkConfig</code></a> can be passed. This object contains the package commit, julia command, and what environment variables will be used when benchmarking. The default values can be seen by using the default constructor</p><pre><code class="language-julia-repl">julia&gt; BenchmarkConfig()
BenchmarkConfig:
    id: nothing
    juliacmd: `/home/user/julia/julia`
    env:</code></pre><p>The <code>id</code> is a commit, branch etc as described in the previous section. An <code>id</code> with value <code>nothing</code> means that the current state of the package will be benchmarked. The default value of <code>juliacmd</code> is <code>joinpath(Sys.BINDIR, Base.julia_exename()</code> which is the command to run the julia executable without any command line arguments.</p><p>To instead benchmark the branch <code>PR</code>, using the julia command <code>julia -O3</code> with the environment variable <code>JULIA_NUM_THREADS</code> set to <code>4</code>, the config would be created as</p><pre><code class="language-julia-repl">julia&gt; config = BenchmarkConfig(id = &quot;PR&quot;,
                                juliacmd = `julia -O3`,
                                env = Dict(&quot;JULIA_NUM_THREADS&quot; =&gt; 4))
BenchmarkConfig:
    id: PR
    juliacmd: `julia -O3`
    env: JULIA_NUM_THREADS =&gt; 4</code></pre><p>To benchmark the package with the config, call <a href="#PkgBenchmark.benchmarkpkg"><code>benchmarkpkg</code></a> as e.g.</p><pre><code class="language-julia">benchmark(&quot;Tensors&quot;, config)</code></pre><div class="admonition info"><div class="admonition-title">Info</div><div class="admonition-text"><p>The <code>id</code> keyword to the <code>BenchmarkConfig</code> does not have to be a branch, it can be most things that git can understand, for example a commit id or a tag.</p></div></div><footer><hr/><a class="previous" href="../define_benchmarks/"><span class="direction">Previous</span><span class="title">Defining a benchmark suite</span></a><a class="next" href="../comparing_commits/"><span class="direction">Next</span><span class="title">Comparing commits</span></a></footer></article></body></html>
