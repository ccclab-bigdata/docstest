<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Readme Â· Jags.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Jags.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Readme</a><ul class="internal"><li><a class="toctext" href="#Purpose-1">Purpose</a></li><li><a class="toctext" href="#What&#39;s-new-1">What&#39;s new</a></li><li><a class="toctext" href="#Requirements-1">Requirements</a></li><li><a class="toctext" href="#A-walk-through-example-1">A walk through example</a></li><li><a class="toctext" href="#Running-a-Jags-script,-some-details-1">Running a Jags script, some details</a></li><li><a class="toctext" href="#To-do-1">To do</a></li></ul></li><li><a class="toctext" href="autodocs/">Docstrings</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Readme</a></li></ul></nav><hr/><div id="topbar"><span>Readme</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Jags-1" href="#Jags-1">Jags</a></h1><p><a href="https://travis-ci.org/goedman/Jags.jl"><img src="https://travis-ci.org/goedman/Jags.jl.svg?branch=master" alt="Travis Build Status"/></a></p><h2><a class="nav-anchor" id="Purpose-1" href="#Purpose-1">Purpose</a></h2><p>A package to use Jags (as an external program) from Julia.</p><p>For more info on Jags, please go to <a href="http://mcmc-jags.sourceforge.net">http://mcmc-jags.sourceforge.net</a>.</p><p>For more info on Mamba, please go to <a href="http://mambajl.readthedocs.org/en/latest/">http://mambajl.readthedocs.org/en/latest/</a>.</p><h2><a class="nav-anchor" id="What&#39;s-new-1" href="#What&#39;s-new-1">What&#39;s new</a></h2><h3><a class="nav-anchor" id="Version-2.0.0-(tagged-Jan-2019)-1" href="#Version-2.0.0-(tagged-Jan-2019)-1">Version 2.0.0 (tagged Jan 2019)</a></h3><ol><li>Thanks to Hellema Jags.jl has been updated for Julia 1.</li></ol><h3><a class="nav-anchor" id="Version-1.0.5-(tagged-Jan-2018)-1" href="#Version-1.0.5-(tagged-Jan-2018)-1">Version 1.0.5 (tagged Jan 2018)</a></h3><ol><li>Added an option to specify thinning by Jags. Jagsmodel() now accepts a jagsthin arguments. Default is jagsthin=1. Thanks to @hellemo. See examples Line3 and Line4.</li><li>Further updates by Hellemo (e.g. to improve readdlm performance).</li><li>Tested on Julia 0.6. Not yet on Julia 0.7-.</li></ol><h3><a class="nav-anchor" id="Version-1.0.2-1" href="#Version-1.0.2-1">Version 1.0.2</a></h3><ol><li>Requires Julia v&quot;0.5.0-rc3&quot;.</li><li>Updated .travis.yml to jsut test on Julia 0.5</li></ol><h3><a class="nav-anchor" id="Version-1.0.0-1" href="#Version-1.0.0-1">Version 1.0.0</a></h3><ol><li>Updated for Julia 0.5</li></ol><h3><a class="nav-anchor" id="Version-0.2.0-1" href="#Version-0.2.0-1">Version 0.2.0</a></h3><ol><li>Added badges for Julia package listing</li><li>Exported JAGS_HOME in Jags.jl</li><li>Updated for to also run Julia 0.4 pre-releases</li></ol><h3><a class="nav-anchor" id="Version-0.1.5-1" href="#Version-0.1.5-1">Version 0.1.5</a></h3><ol><li>Updated .travis.yml</li><li>The runtests.jl script now prints package version</li></ol><h3><a class="nav-anchor" id="Version-0.1.4-1" href="#Version-0.1.4-1">Version 0.1.4</a></h3><ol><li>Allowed JAGS<em>HOME and JULIA</em>SVG_BROWSER to be set from either ~/.juliarc.jl or as an evironment variable. Updated README accordingly.</li></ol><h3><a class="nav-anchor" id="Version-0.1.3-1" href="#Version-0.1.3-1">Version 0.1.3</a></h3><ol><li>Removed upper bound on Julia in REQUIRE. </li></ol><h3><a class="nav-anchor" id="Version-0.1.2-1" href="#Version-0.1.2-1">Version 0.1.2</a></h3><ol><li>Fix for access to environment variables on Windows.</li></ol><h3><a class="nav-anchor" id="Version-0.1.1-1" href="#Version-0.1.1-1">Version 0.1.1</a></h3><ol><li>Stores Jags&#39;s input &amp; output files in a subdirectory of the working directory.</li><li>Added Bones2 example.</li></ol><h3><a class="nav-anchor" id="Version-0.1.0-1" href="#Version-0.1.0-1">Version 0.1.0</a></h3><p>The two most important features introduced in version 0.1.0 are:</p><ol><li>Using Mamba to display and diagnose simulation results. The call to jags() to sample now returns a Mamba Chains object (previously it returned a dictionary). </li><li>Added the ability to specify RNGs in the initializations file for running simulations in parallel.</li></ol><h3><a class="nav-anchor" id="Version-0.0.4-1" href="#Version-0.0.4-1">Version 0.0.4</a></h3><ol><li>Added the ability to start multiple Jags scripts in parallel.</li></ol><h3><a class="nav-anchor" id="Version-0.0.3-and-earlier-1" href="#Version-0.0.3-and-earlier-1">Version 0.0.3 and earlier</a></h3><ol><li>Parsing structure for input arguments to Stan.</li><li>Single process execution of a Jags simulations.</li><li>Read created output files by Jags back into Julia.</li></ol><h2><a class="nav-anchor" id="Requirements-1" href="#Requirements-1">Requirements</a></h2><p>This version of the Jags.jl package assumes that: </p><ol><li><p>Jags is installed and the jags binary is on PATH. The variable JAGS<em>HOME is currently initialized either from ~/.juliarc.jl or from an environment variable JAGS</em>HOME. JAGS_HOME currently only used in runtests.jl to disable attempting to run tests that need the Jags executable on PATH.</p></li><li><p>Mamba (see <a href="https://github.com/brian-j-smith/Mamba.jl">https://github.com/brian-j-smith/Mamba.jl</a>) is installed.</p></li><li><p>DataArrays (see <a href="https://github.com/JuliaStats/DataArrays.jl">https://github.com/JuliaStats/DataArrays.jl</a>) is installed.</p></li><li><p>On OSX, all Jags-j03-v0.2.0 examples check the environment variable JULIA<em>SVG</em>BROWSER to automatically display (in a browser) the simulation results (after creating .svg files), e.g. on my system I have exported JULIA<em>SVG</em>BROWSER=&quot;Google Chrome.app&quot;. For other platforms the final lines in the Examples/xxxx.jl files may need to be adjusted (or removed). In any case, on all platforms, both a .svg and a .pdf file will be created and left behind in the working directory.</p></li></ol><p>JAGS<em>HOME and JULIA</em>SVG_BROWSER can also be defined in ~/.juliarc.jl.</p><p>This version of the package has primarily been tested on Mac OSX 10.10, Julia 0.3.3, Jags 3.4.0 and Mamba 0.4.3. A limited amount of testing has taken place on other platforms by other users of the package (see note 1 in the &#39;To Do&#39; section below).</p><p>To test and run the examples:</p><p><strong>julia &gt;</strong> <span>$Pkg.test(&quot;Jags&quot;)$</span></p><h2><a class="nav-anchor" id="A-walk-through-example-1" href="#A-walk-through-example-1">A walk through example</a></h2><p>As in the Jags.jl setting, the Jags program consumes and produces files in a &#39;tmp&#39; subdirectory of the current directory, it is useful to control the current working directory and restore the original directory at the end of the script.</p><pre><code class="language-none">using Mamba, Jags

ProjDir = dirname(@__FILE__)
cd(ProjDir)</code></pre><p>Variable <code>line</code> holds the model which will be writtten to a file named <code>$(model.name).bugs</code> in the &#39;tmp&#39; subdirectory. The value of model.name is set later on, see the call to Jagsmodel() below.</p><pre><code class="language-none">line = &quot;
model {
  for (i in 1:n) {
        mu[i] &lt;- alpha + beta*(x[i] - x.bar);
        y[i]   ~ dnorm(mu[i],tau);
  }
  x.bar   &lt;- mean(x[]);
  alpha    ~ dnorm(0.0,1.0E-4);
  beta     ~ dnorm(0.0,1.0E-4);
  tau      ~ dgamma(1.0E-3,1.0E-3);
  sigma   &lt;- 1.0/sqrt(tau);
}
&quot;</code></pre><p>Next, define which variables should be monitored (if =&gt; true).</p><pre><code class="language-none">monitors = (String =&gt; Bool)[
  &quot;alpha&quot; =&gt; true,
  &quot;beta&quot; =&gt; true,
  &quot;tau&quot; =&gt; true,
  &quot;sigma&quot; =&gt; true,
]</code></pre><p>The next step is to create and initialize a Jagsmodel:</p><pre><code class="language-none">jagsmodel = Jagsmodel(
  name=&quot;line1&quot;, 
  model=line,
  monitor=monitors,
  #ncommands=1, nchains=4,
  #deviance=true, dic=true, popt=true,
  pdir=ProjDir);

println(&quot;\nJagsmodel that will be used:&quot;)
jagsmodel |&gt; display</code></pre><p>Notice that by default a single command with 4 chains is created. It is possible to run each of the 4 chains in a separate process which has advantages. Using the Bones example as a testcase, on my machine running 1 command simulating a single chain takes 6 seconds, 4 (parallel) commands each simulating 1 chain takes about 9 seconds and a single command simulating 4 chains takes about 25 seconds. Of course this is dependent on the number of available cores and assumes the drawing of samples takes a reasonable chunk of time vs. running a command in a new shell.</p><p>Running chains in separate commands does need additional data to be passed in through the initialization data and is demonstrated in Examples/Line2. Some more details are given below.</p><p>If nchains is set to 1, this is updated in Jagsmodel() if dic and/or popt is requested. Jags needs minimally 2 chains to compute those.</p><p>The input data for the line example is in below data dictionary:</p><pre><code class="language-none">data = Dict(
  &quot;x&quot; =&gt; [1, 2, 3, 4, 5],
  &quot;y&quot; =&gt; [1, 3, 3, 3, 5],
  &quot;n&quot; =&gt; 5
)

println(&quot;Input observed data dictionary:&quot;)
data |&gt; display</code></pre><p>Next define an array of dictionaries with initial values for parameters. If the array of dictionaries has not enough elements, the elements will be recycled for chains/commands:</p><pre><code class="language-none">inits = [
  Dict(&quot;alpha&quot; =&gt; 0,&quot;beta&quot; =&gt; 0,&quot;tau&quot; =&gt; 1),
  Dict(&quot;alpha&quot; =&gt; 1,&quot;beta&quot; =&gt; 2,&quot;tau&quot; =&gt; 1),
  Dict(&quot;alpha&quot; =&gt; 3,&quot;beta&quot; =&gt; 3,&quot;tau&quot; =&gt; 2),
  Dict(&quot;alpha&quot; =&gt; 5,&quot;beta&quot; =&gt; 2,&quot;tau&quot; =&gt; 5)
]

println(&quot;\nInput initial values dictionary:&quot;)
inits |&gt; display
println()</code></pre><p>Run the mcmc simulation, passing in the model, the data, the initial values and the working directory. If &#39;inits&#39; is a single dictionary, it needs to be passed in as &#39;[inits]&#39;, see the Bones example. </p><pre><code class="language-none">sim = jags(jagsmodel, data, inits, ProjDir)
describe(sim)
println()</code></pre><p>Below Mamba.jl based tools are available to diagnose and plot the simulation results:</p><pre><code class="language-none">###### Brooks, Gelman and Rubin Convergence Diagnostic
try
  gelmandiag(sim1, mpsrf=true, transform=true) |&gt; display
catch e
  #println(e)
  gelmandiag(sim, mpsrf=false, transform=true) |&gt; display
end

###### Geweke Convergence Diagnostic
gewekediag(sim) |&gt; display

###### Highest Posterior Density Intervals
hpd(sim) |&gt; display

###### Cross-Correlations
cor(sim) |&gt; display

###### Lag-Autocorrelations
autocor(sim) |&gt; display

###### Plotting
p = plot(sim, [:trace, :mean, :density, :autocor], legend=true);
draw(p, nrow=4, ncol=4, filename=&quot;$(jagsmodel.name)-summaryplot&quot;, fmt=:svg)
draw(p, nrow=4, ncol=4, filename=&quot;$(jagsmodel.name)-summaryplot&quot;, fmt=:pdf)

###### Below will only work on OSX, please adjust for your environment.
###### JULIA_SVG_BROWSER is set from the environment variable JULIA_SVG_BROWSER
@static Sys.isapple() ? if length(JULIA_SVG_BROWSER) &gt; 0
        for i in 1:3
          isfile(&quot;$(jagsmodel.name)-summaryplot-$(i).svg&quot;) &amp;&amp;
            run(`open -a $(JULIA_SVG_BROWSER) &quot;$(jagsmodel.name)-summaryplot-$(i).svg&quot;`)
        end
      end : println()</code></pre><h2><a class="nav-anchor" id="Running-a-Jags-script,-some-details-1" href="#Running-a-Jags-script,-some-details-1">Running a Jags script, some details</a></h2><p>Jags.jl really only consists of 2 functions, Jagsmodel() and jags().</p><p>Jagsmodel() is used to define and set up the basic structure to run a simulation. The full signature of Jagsmodel() is:</p><pre><code class="language-none">function Jagsmodel(;
  name=&quot;Noname&quot;, 
  model=&quot;&quot;, 
  ncommands=1,
  nchains=4,
  adapt=1000,
  update=10000,
  thin=10,
  jagsthin=1,
  monitor=Dict(), 
  deviance=false,
  dic=false,
  popt=false,
  updatejagsfile=true,
  pdir=pwd())</code></pre><p>All arguments are keyword arguments and have default values, although usually at least the name and model arguments will be provided.</p><p>After a Jagsmodel has been created, the workhorse function jags() is called to run the simulation, passing in the Jagsmodel, the data and the initialization for the chains.</p><p>As Jags needs quite a few input files and produces several output files, these are all stored in a subdirectory of the working directory, typically called &#39;tmp&#39;.</p><p>The full signature of jags() is:</p><pre><code class="language-none">function jags(
  model::Jagsmodel,
  data::Dict{String, Any}=Dict{String, Any}(),
  init::Array{Dict{String, Any}, 1} = Dict{String, Any}[],
  ProjDir=pwd();
  updatedatafile::Bool=true,
  updateinitfiles::Bool=true
  )</code></pre><p>All parameters to compile and run the Jags script are implicitly passed in through the model argument.</p><p>The Line2 example shows how to run multiple Jags simulations in parallel. The most simple case, e.g. 4 commands, each with a single chain, can be initialized with an &#39;inits&#39; like shown below:</p><pre><code class="language-none">inits = [
  Dict(&quot;alpha&quot; =&gt; 0,&quot;beta&quot; =&gt; 0,&quot;tau&quot; =&gt; 1,&quot;.RNG.name&quot; =&gt; &quot;base::Wichmann-Hill&quot;),
  Dict(&quot;alpha&quot; =&gt; 1,&quot;beta&quot; =&gt; 2,&quot;tau&quot; =&gt; 1,&quot;.RNG.name&quot; =&gt; &quot;base::Marsaglia-Multicarry&quot;),
  Dict(&quot;alpha&quot; =&gt; 3,&quot;beta&quot; =&gt; 3,&quot;tau&quot; =&gt; 2,&quot;.RNG.name&quot; =&gt; &quot;base::Super-Duper&quot;),
  Dict(&quot;alpha&quot; =&gt; 5,&quot;beta&quot; =&gt; 2,&quot;tau&quot; =&gt; 5,&quot;.RNG.name&quot; =&gt; &quot;base::Mersenne-Twister&quot;)
]</code></pre><p>The first entry in the &#39;inits&#39; array will be passed into the first chain in the first command process, the second entry to the second process, etc. A second chain in the first command would be initialized with the second entry, etc. </p><h2><a class="nav-anchor" id="To-do-1" href="#To-do-1">To do</a></h2><p>More features will be added as requested by users and as time permits. Please file an issue/comment/request.</p><p><strong>Note 1:</strong> In order to support platforms other than OS X, help is needed to test on such platforms.</p><footer><hr/><a class="next" href="autodocs/"><span class="direction">Next</span><span class="title">Docstrings</span></a></footer></article></body></html>
