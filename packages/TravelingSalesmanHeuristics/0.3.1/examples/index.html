<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples · Traveling Salesman Heuristics</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Traveling Salesman Heuristics</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../heuristics/">Heuristics</a></li><li class="current"><a class="toctext" href>Examples</a><ul class="internal"><li><a class="toctext" href="#Basic-usage-1">Basic usage</a></li><li><a class="toctext" href="#Using-a-specific-heuristic-1">Using a specific heuristic</a></li><li><a class="toctext" href="#Simulated-annealing-refinements-1">Simulated annealing refinements</a></li><li><a class="toctext" href="#Lower-bounds-1">Lower bounds</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Examples</a></li></ul></nav><hr/><div id="topbar"><span>Examples</span><a class="fa fa-bars" href="#"></a></div></header><p>This page gives some examples of using TravelingSalesmanHeuristics. For convenience and so we can easily visualize the problems, we&#39;ll use planar Euclidean instances generated as follows:</p><pre><code class="language-none">using Random
function generate_instance(n)
	Random.seed!(47)
	pts = rand(2, n)
	distmat = [norm(pts[:,i] - pts[:,j]) for i in 1:n, j in 1:n]
	return pts, distmat
end</code></pre><p>In this function and throughout the examples, I routinely reseed the global random number generator (with value 47, which is a <a href="http://magazine.pomona.edu/pomoniana/2015/02/13/the-mystery-of-47/">great number</a>) so that (hopefully) the examples can be reproduced, at least if you&#39;re using the same Julia version.</p><p>Some handy visualization functions:</p><pre><code class="language-none">using Gadfly
plot_instance(pts) = plot(x = pts[1,:], y = pts[2,:], Geom.point, Guide.xlabel(nothing), Guide.ylabel(nothing))
function plot_solution(pts, path, extras = [])
	ptspath = pts[:,path]
	plot(x = ptspath[1,:], y = ptspath[2,:], Geom.point, Geom.path, Guide.xlabel(nothing), Guide.ylabel(nothing), extras...)
end</code></pre><h2><a class="nav-anchor" id="Basic-usage-1" href="#Basic-usage-1">Basic usage</a></h2><p>First, generate and plot a small instance:</p><pre><code class="language-none">pts, distmat = generate_instance(20)
plot_instance(pts)</code></pre><p><img src="../images/examples/small_instance.png" alt="small instance"/></p><p>A quick solution (run it twice to avoid measuring precompilation):</p><pre><code class="language-none">Random.seed!(47)
@time path, cost = solve_tsp(distmat; quality_factor = 5)
      0.000050 seconds (34 allocations: 3.797 KiB)
    ([4, 19, 17, 14, 5, 1, 20, 9, 16, 2  …  6, 10, 15, 11, 18, 8, 12, 13, 3, 4], 3.8300484331007696)
plot_solution(pts, path)</code></pre><p><img src="../images/examples/small_instance_solved.png" alt="small instance solved"/></p><p>It looks like we&#39;ve found the optimum path, and a higher <code>quality_factor</code> doens&#39;t give a better objective:</p><pre><code class="language-none">Random.seed!(47)
@time path, cost = solve_tsp(distmat; quality_factor = 80)
      0.006352 seconds (92.43 k allocations: 1.551 MiB)
    ([2, 16, 9, 20, 1, 5, 14, 17, 19, 4  …  13, 12, 8, 18, 11, 15, 10, 6, 7, 2], 3.830048433100769)</code></pre><p>On a bigger instance, the <code>quality_factor</code> makes more of a difference:</p><pre><code class="language-none">pts, distmat = generate_instance(200)
@time path, cost = solve_tsp(distmat; quality_factor = 5)
      0.008352 seconds (34 allocations: 21.031 KiB)
    ([53, 93, 60, 29, 159, 135, 187, 8, 127, 178  …  11, 10, 154, 59, 80, 6, 108, 188, 57, 53], 10.942110669021305)
@time path, cost = solve_tsp(distmat; quality_factor = 80)
      2.066067 seconds (9.00 M allocations: 177.469 MiB, 2.61% gc time)
    ([20, 27, 76, 23, 92, 146, 161, 194, 152, 171  …  66, 36, 147, 124, 32, 70, 34, 120, 47, 20], 10.552544594904079)
plot_solution(pts, path)</code></pre><p><img src="../images/examples/big_instance_solved.png" alt="big instance solved"/></p><p>Note that increasing <code>quality_factor</code> greatly increases the runtime but only slightly improves the objective. This pattern is common.</p><h2><a class="nav-anchor" id="Using-a-specific-heuristic-1" href="#Using-a-specific-heuristic-1">Using a specific heuristic</a></h2><pre><code class="language-julia">pts, distmat = generate_instance(100)
path_nn, cost_nn = nearest_neighbor(distmat; firstcity = 1, do2opt = false) # cost is 9.93
path_nn2opt, cost_nn2opt = nearest_neighbor(distmat; firstcity = 1, do2opt = true) # cost is 8.15
path_fi, cost_fi = farthest_insertion(distmat; firstcity = 1, do2opt = false) # cost is 8.12
path_fi2opt, cost_fi2opt = farthest_insertion(distmat; firstcity = 1, do2opt = true) # cost is 8.06</code></pre><p><img src="../images/examples/path_nn.png" alt="path nearest neighbor"/><img src="../images/examples/path_nn2opt.png" alt="path nearest neighbor 2-opt"/></p><p><img src="../images/examples/path_fi.png" alt="path farthest insertion"/><img src="../images/examples/path_fi2opt.png" alt="path farthest insertion 2-opt"/></p><h2><a class="nav-anchor" id="Simulated-annealing-refinements-1" href="#Simulated-annealing-refinements-1">Simulated annealing refinements</a></h2><p>The current simulated annealing implementation is very simple (pull requests most welcome!), but it can nonetheless be useful for path refinement. Here&#39;s a quick example:</p><pre><code class="language-julia">pts, distmat = generate_instance(300)
path_quick, cost_quick = solve_tsp(distmat)
    ([104, 185, 290, 91, 294, 269, 40, 205, 121, 271  …  156, 237, 97, 288, 137, 63, 257, 168, 14, 104], 13.568672416542647)
path_sa, cost_sa = simulated_annealing(distmat; init_path = Nullable(path_quick), num_starts = 10)
    ([104, 14, 168, 257, 63, 137, 46, 101, 44, 193  …  220, 269, 40, 121, 205, 294, 91, 290, 185, 104], 13.298439981448235)</code></pre><h2><a class="nav-anchor" id="Lower-bounds-1" href="#Lower-bounds-1">Lower bounds</a></h2><p>In the previous section, we generated a 300 point TSP in the unit square. Is the above solution with cost about <code>13.3</code> any good? We can get a rough lower bound:</p><pre><code class="language-none">lowerbound(distmat)
    11.5998918075456</code></pre><p>Let&#39;s see where that bound came from:</p><pre><code class="language-none">TravelingSalesmanHeuristics.vertwise_bound(distmat)
    8.666013688087942
TravelingSalesmanHeuristics.hkinspired_bound(distmat)
    11.5998918075456</code></pre><p>Because our problem is symmetric, the latter bound based on spanning trees applies, and this bound is typically tighter.</p><p>If we use an integer program to solve the TSP to certified optimality (beyond the scope of this package), we find that the optimal solution has cost about <code>12.82</code>. So the final path found by simulated annealing is about <code>3.7%</code> worse than the optimal path, and the lower bound reported is about <code>9.5%</code> lower than the optimal cost. These values are quite typical for mid-sized Euclidean instances.  <img src="../images/examples/300_optimal.png" alt="300 point optimal path"/><img src="../images/examples/300_sa.png" alt="300 point simulated annealing path"/></p><footer><hr/><a class="previous" href="../heuristics/"><span class="direction">Previous</span><span class="title">Heuristics</span></a></footer></article></body></html>
