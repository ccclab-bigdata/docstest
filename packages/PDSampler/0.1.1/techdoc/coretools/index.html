<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Core tools Â· PDSampler.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../../assets/partial.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>PDSampler.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Introduction</a></li><li><a class="toctext" href="../../aboutpdsampler/">About PDSampler</a></li><li><span class="toctext">Examples</span><ul><li><a class="toctext" href="../../examples/ex_gbps1/">Global BPS</a></li><li><a class="toctext" href="../../examples/ex_lbps1/">Local BPS</a></li></ul></li><li><span class="toctext">Technical Documentation</span><ul><li><a class="toctext" href="../structure/">Code structure</a></li><li class="current"><a class="toctext" href>Core tools</a><ul class="internal"><li><a class="toctext" href="#Geometry-1">Geometry</a></li><li><a class="toctext" href="#Sampling-from-an-IPP-1">Sampling from an IPP</a></li><li><a class="toctext" href="#Kernels-1">Kernels</a></li></ul></li><li><a class="toctext" href="../models/">Models</a></li><li><a class="toctext" href="../global/">Global sampler</a></li><li><a class="toctext" href="../local/">Local sampler</a></li></ul></li><li><span class="toctext">Contributing</span><ul><li><a class="toctext" href="../../contributing/addingexample/">New example</a></li><li><a class="toctext" href="../../contributing/addingfeature/">New feature</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Technical Documentation</li><li><a href>Core tools</a></li></ul></nav><hr/><div id="topbar"><span>Core tools</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="td-coretools-1" href="#td-coretools-1">Core tools</a></h1><p>Link to the source files:</p><ul><li><a href="https://github.com/alan-turing-institute/PDSampler.jl/blob/master/src/geometry.jl"><code>geometry.jl</code></a></li><li><a href="https://github.com/alan-turing-institute/PDSampler.jl/blob/master/src/ippsampler.jl"><code>ippsampler.jl</code></a></li><li><a href="https://github.com/alan-turing-institute/PDSampler.jl/blob/master/src/kernels.jl"><code>kernels.jl</code></a></li></ul><h2><a class="nav-anchor" id="Geometry-1" href="#Geometry-1">Geometry</a></h2><p>The <code>geometry.jl</code> code exports the following <strong>immutable</strong> types:</p><ul><li><code>Unconstrained &lt;: Domain</code>,</li><li><code>Polygonal &lt;: Domain</code>.</li></ul><p>and a function</p><ul><li><code>nextboundary</code></li></ul><p>Any geometry type needs to have a <code>nextboundary</code> function associated with it of the form <code>nextboundary(g, x, v)</code> where <code>g</code> refers to a geometry object, <code>x</code> to the position and <code>v</code> to the velocity. The aim of that function is to:</p><ul><li>return a time of first hit <span>$\tau_h$</span> (following the ray <span>$x+vt$</span>, for <span>$t&gt;0$</span>),</li><li>return the normal to the boundary at that hitting point.</li></ul><p>So for example, the <code>Unconstrained</code> is an empty type and the associated <code>nextboundary</code> function just returns <code>(NaN, NaN)</code> indeed a boundary will never be crossed and there is no normal. These <code>NaN</code> are processed by calling functions.</p><p>The <code>Polygonal</code> domain requires the definition of the normals and the intercepts. The <code>nextboundary</code> function is pretty simple (intersection of lines). Note a few tricks for numerical stability:</p><ul><li>near parallel case can be ignored (the crossing time will be huge compared to bouncing time or refreshment time and therefore we can just ignore it)</li><li>negative times can be ignored (we&#39;re only going forward)</li><li>times that are very close to zero are ignored (means that we are currently already very close to the boundary meaning that we will bounce away)</li></ul><h2><a class="nav-anchor" id="Sampling-from-an-IPP-1" href="#Sampling-from-an-IPP-1">Sampling from an IPP</a></h2><p>The <code>ippsampler.jl</code> exports the following <strong>immutable</strong> types:</p><ul><li><code>NextEvent</code>,</li><li><code>LinearBound &lt;: Thinning &lt;: IPPSamplingMethod</code>,</li></ul><p>and the following functions</p><ul><li><code>nextevent_bps</code>,</li><li><code>nextevent_zz</code>.</li></ul><p>The <code>NextEvent</code> type encapsulates an object returned when sampling from the IPP is required. It contains:</p><ul><li>a bouncing time</li><li>a function returning whether the bouncing time should be accepted or not (see <code>Thinning</code>)</li><li>a flipindex (see <code>nextevent_zz</code>)</li></ul><p>The functions <code>nextevent_*</code> are overloaded for the different possible sampling cases.</p><h3><a class="nav-anchor" id="Exact-sampling-1" href="#Exact-sampling-1">Exact sampling</a></h3><p>Exact sampling is possible for specific distributions. In that case, the <code>dobounce</code> function returns <code>true</code> all the time. An example is the <code>MvGaussian</code> model for which we can indeed sample from the corresponding IPP analytically. See for example the definition of</p><pre><code class="language-julia">nextevent_bps{T&lt;:Vector{Float}}(g::MvGaussian, x::T, v::T)::NextEvent</code></pre><p>Note the signature of the function. The first parameter indicates how the sampling should be done and the information to do so. The second and third parameters indicate the ray along which the bouncing time should be produced.</p><h3><a class="nav-anchor" id="Sampling-via-thinning-1" href="#Sampling-via-thinning-1">Sampling via thinning</a></h3><p>The <code>LinearBound</code> type allows to define a linear upper bound on the intensity of the IPP when you have access to a global bound on the eigenvalues of the Hessian (see <a href="https://arxiv.org/pdf/1701.04244.pdf">this paper</a> for more details). An accept reject step can then be performed in the <code>nextevent_*</code> function (<code>dobounce</code>).</p><p>An example is the Bayesian logistic regression for which you do have such a bound.</p><p>In that case the <code>nextevent_bps</code> returns a bouncing time computed thanks to the upper bound and the <code>dobounce</code> corresponds to a simple accept/reject step.</p><h2><a class="nav-anchor" id="Kernels-1" href="#Kernels-1">Kernels</a></h2><p>The <code>kernels.jl</code> code exports a few functions, all of which define how the velocity should be updated in a variety of circumstances. Some of these functions have an exclamation mark attached to them indicating that the transformation is done <em>in place</em> (for efficiency). The <code>refresh_*</code> functions help indicate how the velocity should be refreshed (e.g. drawn from a spherical gaussian). The <code>reflect_*</code> indicate how the velocity should bounce (e.g. specular reflection).</p><footer><hr/><a class="previous" href="../structure/"><span class="direction">Previous</span><span class="title">Code structure</span></a><a class="next" href="../models/"><span class="direction">Next</span><span class="title">Models</span></a></footer></article></body></html>
