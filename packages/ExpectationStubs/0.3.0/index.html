<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Readme Â· ExpectationStubs.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ExpectationStubs.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Readme</a><ul class="internal"></ul></li><li><a class="toctext" href="autodocs/">Docstrings</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Readme</a></li></ul></nav><hr/><div id="topbar"><span>Readme</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="ExpectationStubs-1" href="#ExpectationStubs-1">ExpectationStubs</a></h1><p><a href="https://travis-ci.org/oxinabox/ExpectationStubs.jl"><img src="https://travis-ci.org/oxinabox/ExpectationStubs.jl.svg?branch=master" alt="Build Status"/></a> <a href="https://ci.appveyor.com/project/oxinabox/expectationstubs-jl/branch/master"><img src="https://ci.appveyor.com/api/projects/status/46sjp95g6xy9wwt1/branch/master?svg=true" alt="Build status"/></a></p><p>This package exists to help you make testing stubs. Its not to help you do patch mocks into code: for that see <a href="https://github.com/invenia/Mocking.jl">Mocking.jl</a>.</p><p>In theory the stubs created using ExpectationStubs are ideal for patching in with Mocking.jl. This is still in alpha, and that hasn&#39;t been tested yet. (Raise an issue and let me know if that works.)</p><p>These stub are ideal for if you already have dependency injection of functions set up.</p><p>For purposes of this package, a stub and a mock at the same thing.</p><p>There are 5 key functions (check their docstrings on the REPL).</p><ul><li><code>@stub foo</code>: declares a stub called <code>foo</code></li><li><code>@expect foo(::Integer, 8.5)=77</code>: sets up an expectation that <code>foo</code> will be called with an <code>Integer</code> and the exact value <code>8.5</code>. and if so it is to return <code>77</code></li><li><code>@used  foo(100, ::Real)</code> checks to see if <code>foo</code> was called with the the exact value <code>100</code> and something of type <code>Real</code></li><li><code>@usecount foo(100, ::Real)</code> as per <code>@used</code> except returns the number of times called</li><li><code>all_expectations_used(foo)</code> checks that every expectation declared on <code>foo</code> was used (returns a <code>Bool</code>).</li></ul><h3><a class="nav-anchor" id="Example-Usage-1" href="#Example-Usage-1">Example Usage</a></h3><p>Lets say I have a function that checks on the status of say some pipe and if it has too much pressure, takes some response: normally calling a function called <code>email</code></p><pre><code class="language-julia">function check_status(pressure, its_bad_callback=email)
    if pressure &gt; 9000
        its_bad_callback(&quot;phil@example.com&quot;, &quot;Darn it Phil, the thing is gonna blow&quot;)
        return false
    end
    true
end</code></pre><p>Now, when testing this function out, I don&#39;t want Phil to get 100s of emails. So I want to replace the <code>its_bad_callback</code> with some mock.</p><p>So I could write a little closure in my testing code, and have that closure set a variable and then check that variable, to see how it was called. And that is pretty good. But it is a bit adhock.</p><p>Enter ExpectationStubs.jl</p><pre><code class="language-julia">using Base.Test
using ExpectationStubs

@testset &quot;Check the pipe&quot; begin
    @stub fakeemail
    @expect fakeemail(&quot;phil@example.com&quot;, ::AbstractString) = nothing # no return

    # check what happens if everything is OK
    @test check_status(1000, fakeemail) == true
    @test !@used fakeemail(&quot;phil@example.com&quot;, ::Any)
    ### Better not email Phil if everything is going ok.
    @test check_status(9007, fakeemail) == false
    @test @used fakeemail(&quot;phil@example.com&quot;, ::Any)
end</code></pre><footer><hr/><a class="next" href="autodocs/"><span class="direction">Next</span><span class="title">Docstrings</span></a></footer></article></body></html>
