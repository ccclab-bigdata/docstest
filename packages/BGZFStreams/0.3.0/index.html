<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Readme Â· BGZFStreams.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>BGZFStreams.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Readme</a><ul class="internal"><li><a class="toctext" href="#Synopsis-1">Synopsis</a></li><li><a class="toctext" href="#Usage-1">Usage</a></li><li><a class="toctext" href="#Parallel-Processing-1">Parallel Processing</a></li></ul></li><li><a class="toctext" href="autodocs/">Docstrings</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Readme</a></li></ul></nav><hr/><div id="topbar"><span>Readme</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="BGZFStreams-1" href="#BGZFStreams-1">BGZFStreams</a></h1><p><a href="https://travis-ci.org/BioJulia/BGZFStreams.jl"><img src="https://travis-ci.org/BioJulia/BGZFStreams.jl.svg?branch=master" alt="Build Status"/></a> <a href="http://codecov.io/github/BioJulia/BGZFStreams.jl?branch=master"><img src="http://codecov.io/github/BioJulia/BGZFStreams.jl/coverage.svg?branch=master" alt="codecov.io"/></a></p><p>BGZF is a compression format that supports random access using <em>virtual file offsets</em>.</p><p>See the SAM/BAM file format specs for the details of BGZF: <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">https://samtools.github.io/hts-specs/SAMv1.pdf</a>.</p><h2><a class="nav-anchor" id="Synopsis-1" href="#Synopsis-1">Synopsis</a></h2><pre><code class="language-julia">using BGZFStreams

# The first argument is a filename or an IO object (e.g. IOStream).
stream = BGZFStream(&quot;data.bgz&quot;)

# BGZFStream is a subtype of IO and works like a usual IO object.
while !eof(stream)
    byte = read(stream, UInt8)
    # do something...
end

# BGZFStream is also seekable with a VirtualOffset.
seek(stream, VirtualOffset(0, 2))

# The current virtual file offset is available.
virtualoffset(stream)

close(stream)</code></pre><h2><a class="nav-anchor" id="Usage-1" href="#Usage-1">Usage</a></h2><p>The BGZFStreams.jl package exports three types and a function to the package user:</p><ul><li>Types:<ul><li><code>BGZFStream</code>: an <code>IO</code> stream of the BGZF file format</li><li><code>VirtualOffset</code>: data offset in a BGZF file</li><li><code>BGZFDataError</code>: an error type thrown when reading a malformed byte stream</li></ul></li><li>Function:<ul><li><code>virtualoffset(stream)</code>: returns the current virtual file offset of <code>stream</code></li></ul></li></ul><p>The <code>BGZFStream</code> type wraps an underlying <code>IO</code> object and transparently inflate (for reading) or deflate (for writing) data. Since it is a subtype of <code>IO</code>, an instance of it behaves like other <code>IO</code> objects, but the <code>seek</code> method takes a virtual offset instead of a normal file offset as its second argument.</p><p>The <code>VirtualOffset</code> type represents a 64-bit virtual file offset as described in the specification of the SAM file format. That is, the most significant 48-bit integer of a virtual offset is a byte offset to the BGZF file to the beginning position of a BGZF block and the least significant 16-bit integer is a byte offset to the uncompressed byte(s).</p><p>The <code>BGZFDataError</code> type is a subtype of <code>Exception</code> and used to throw an exception when invalid data are read.</p><p>The <code>virtualoffset(stream::BGZFStream)</code> returns the current virtual file offset. More specifically, it returns the virtual offset of the next reading byte while reading and the next writing byte while writing.</p><h2><a class="nav-anchor" id="Parallel-Processing-1" href="#Parallel-Processing-1">Parallel Processing</a></h2><p>A major bottleneck of processing a BGZF file is the inflation and deflation process. The throughput of reading data is ~100 MiB/s, which is quite slower than that of raw reading from a file. In order to alleviate this problem, this package supports parallelized inflation when reading compressed data. This requires the support of multi-threading introduced in Julia 0.5. The <code>JULIA_NUM_THREADS</code> environmental variable sets the number of threads used for processing.</p><pre><code class="language-none">bash-3.2$ JULIA_NUM_THREADS=2 julia -q
julia&gt; using Base.Threads

julia&gt; nthreads()
2</code></pre><footer><hr/><a class="next" href="autodocs/"><span class="direction">Next</span><span class="title">Docstrings</span></a></footer></article></body></html>
